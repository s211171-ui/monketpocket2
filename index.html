<!DOCTYPE html>
<html lang="zh-HK">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Monkey Pocket - 魔法百宝袋管理系统</title>
  <!-- 引入外部资源 -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <!-- 配置Tailwind -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            monkey: {
              yellow: '#FFD700',
              dark: '#121212',
              darker: '#0A0A0A',
              blue: '#165DFF',
              gray: '#333333',
              lightgray: '#666666',
              green: '#10B981',
              red: '#EF4444',
              purple: '#8B5CF6',
              orange: '#F97316'
            },
          },
          fontFamily: {
            inter: ['Inter', 'sans-serif'],
            noto: ['"Noto Sans HK"', 'sans-serif'],
          },
        },
      }
    }
  </script>
  
  <!-- 自定义样式 -->
  <style type="text/tailwindcss">
    @layer utilities {
      .content-auto {
        content-visibility: auto;
      }
      .text-shadow {
        text-shadow: 0 0 10px rgba(255, 215, 0, 0.7);
      }
      .glow {
        box-shadow: 0 0 15px rgba(22, 93, 255, 0.5);
      }
      .glow-green {
        box-shadow: 0 0 15px rgba(16, 185, 129, 0.5);
      }
      .glow-purple {
        box-shadow: 0 0 15px rgba(139, 92, 246, 0.5);
      }
      .glow-orange {
        box-shadow: 0 0 15px rgba(249, 115, 22, 0.5);
      }
      .monkey-bg {
        background: radial-gradient(circle at center, #1A1A1A 0%, #0A0A0A 100%);
      }
      .scrollbar-hide::-webkit-scrollbar {
        display: none;
      }
      .scrollbar-hide {
        -ms-overflow-style: none;
        scrollbar-width: none;
      }
      .border-gradient {
        border-image: linear-gradient(45deg, #FFD700, #165DFF) 1;
      }
      .page-transition {
        opacity: 0;
        transform: translateY(20px);
        transition: opacity 0.3s ease, transform 0.3s ease;
      }
      .page-transition.active {
        opacity: 1;
        transform: translateY(0);
      }
      .gradient-text {
        background: linear-gradient(45deg, #FFD700, #165DFF);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }
    }
  </style>
  
  <!-- 导入字体 -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Noto+Sans+HK:wght@300;400;500;700&display=swap" rel="stylesheet">
</head>

<body class="font-inter bg-monkey-darker text-white min-h-screen flex flex-col monkey-bg">
  <!-- 语言切换 -->
  <div class="fixed top-4 right-20 z-50">
    <div class="flex space-x-2 bg-monkey-gray/80 backdrop-blur-md rounded-full p-1 border border-monkey-gray/50">
      <button id="langEN" class="lang-btn px-3 py-1 rounded-full text-sm font-medium text-gray-300 hover:text-white transition-all">EN</button>
      <button id="langZH" class="lang-btn px-3 py-1 rounded-full text-sm font-medium bg-monkey-blue text-white transition-all">中文</button>
    </div>
  </div>

  <!-- 用户账户菜单 -->
  <div id="userMenu" class="fixed top-4 right-4 z-50 hidden">
    <div class="relative">
      <button id="userMenuBtn" class="flex items-center bg-monkey-gray/80 backdrop-blur-md rounded-full p-2 border border-monkey-gray/50 hover:border-monkey-blue transition-all">
        <div class="w-8 h-8 rounded-full bg-monkey-yellow flex items-center justify-center mr-2">
          <span class="text-monkey-darker font-bold text-sm" id="userInitial">U</span>
        </div>
        <span id="usernameDisplay" class="text-sm font-medium mr-2">用户</span>
        <i class="fa fa-chevron-down text-xs"></i>
      </button>
      
      <div id="userDropdown" class="absolute right-0 top-full mt-2 w-48 bg-monkey-gray/95 backdrop-blur-lg rounded-lg border border-monkey-gray/50 shadow-lg hidden">
        <div class="p-4 border-b border-monkey-gray/50">
          <p class="text-sm font-medium" id="dropdownUsername">用户名</p>
          <p class="text-xs text-gray-400" id="dropdownEmail">邮箱</p>
        </div>
        <div class="p-2">
          <a href="#dashboard" class="user-menu-item block px-3 py-2 text-sm rounded hover:bg-monkey-gray/70 transition-colors" data-i18n="userMenuDashboard">仪表板</a>
          <a href="#activate" class="user-menu-item block px-3 py-2 text-sm rounded hover:bg-monkey-gray/70 transition-colors" data-i18n="userMenuActivate">激活设备</a>
          <a href="#myPockets" class="user-menu-item block px-3 py-2 text-sm rounded hover:bg-monkey-gray/70 transition-colors" data-i18n="userMenuMyPockets">我的百宝袋</a>
          <a href="#items" class="user-menu-item block px-3 py-2 text-sm rounded hover:bg-monkey-gray/70 transition-colors" data-i18n="userMenuItems">我的物品</a>
          <a href="#storage" class="user-menu-item block px-3 py-2 text-sm rounded hover:bg-monkey-gray/70 transition-colors" data-i18n="userMenuStorage">购买存储格</a>
          <a href="#retrieve" class="user-menu-item block px-3 py-2 text-sm rounded hover:bg-monkey-gray/70 transition-colors" data-i18n="userMenuRetrieve">远程取物</a>
          <div class="border-t border-monkey-gray/50 my-2"></div>
          <button id="logoutBtn" class="w-full text-left px-3 py-2 text-sm rounded hover:bg-monkey-red/20 hover:text-monkey-red transition-colors" data-i18n="userMenuLogout">退出登录</button>
        </div>
      </div>
    </div>
  </div>

  <!-- 管理员菜单 -->
  <div id="adminMenu" class="fixed top-4 right-4 z-50 hidden">
    <div class="relative">
      <button id="adminMenuBtn" class="flex items-center bg-monkey-orange/80 backdrop-blur-md rounded-full p-2 border border-monkey-orange/50 hover:border-monkey-orange transition-all">
        <div class="w-8 h-8 rounded-full bg-monkey-orange flex items-center justify-center mr-2">
          <span class="text-monkey-darker font-bold text-sm">A</span>
        </div>
        <span id="adminNameDisplay" class="text-sm font-medium mr-2">管理员</span>
        <i class="fa fa-chevron-down text-xs"></i>
      </button>
      
      <div id="adminDropdown" class="absolute right-0 top-full mt-2 w-48 bg-monkey-gray/95 backdrop-blur-lg rounded-lg border border-monkey-gray/50 shadow-lg hidden">
        <div class="p-4 border-b border-monkey-gray/50">
          <p class="text-sm font-medium">MonkeyKingdomCEO</p>
          <p class="text-xs text-gray-400">管理员账户</p>
        </div>
        <div class="p-2">
          <a href="#adminDashboard" class="admin-menu-item block px-3 py-2 text-sm rounded hover:bg-monkey-gray/70 transition-colors">管理后台</a>
          <a href="#adminCreateCodes" class="admin-menu-item block px-3 py-2 text-sm rounded hover:bg-monkey-gray/70 transition-colors">生成激活码</a>
          <a href="#adminViewUsers" class="admin-menu-item block px-3 py-2 text-sm rounded hover:bg-monkey-gray/70 transition-colors">查看用户</a>
          <a href="#adminViewPockets" class="admin-menu-item block px-3 py-2 text-sm rounded hover:bg-monkey-gray/70 transition-colors">查看百宝袋</a>
          <div class="border-t border-monkey-gray/50 my-2"></div>
          <button id="adminLogoutBtn" class="w-full text-left px-3 py-2 text-sm rounded hover:bg-monkey-red/20 hover:text-monkey-red transition-colors">退出管理后台</button>
        </div>
      </div>
    </div>
  </div>

  <!-- 导航栏 -->
  <header id="navbar" class="fixed w-full z-40 transition-all duration-300 bg-monkey-darker/95 backdrop-blur-md border-b border-monkey-gray/30">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between items-center py-4">
        <!-- 品牌Logo -->
        <div class="flex items-center space-x-2 cursor-pointer" id="logoHome">
          <div class="w-10 h-10 rounded-full bg-monkey-yellow flex items-center justify-center">
            <span class="text-monkey-darker font-bold text-xl">MK</span>
          </div>
          <span class="text-2xl font-bold text-shadow">Monkey <span class="text-monkey-yellow">Pocket</span></span>
        </div>
        
        <!-- 导航链接 - 桌面端 -->
        <nav class="hidden md:flex items-center space-x-8">
          <a href="#dashboard" class="text-gray-300 hover:text-monkey-yellow transition-colors duration-300 page-link" data-i18n="navDashboard">仪表板</a>
          <a href="#activate" class="text-gray-300 hover:text-monkey-yellow transition-colors duration-300 page-link" data-i18n="navActivate">激活设备</a>
          <a href="#myPockets" class="text-gray-300 hover:text-monkey-yellow transition-colors duration-300 page-link" data-i18n="navMyPockets">我的百宝袋</a>
          <a href="#items" class="text-gray-300 hover:text-monkey-yellow transition-colors duration-300 page-link" data-i18n="navItems">我的物品</a>
          <a href="#storage" class="text-gray-300 hover:text-monkey-yellow transition-colors duration-300 page-link" data-i18n="navStorage">购买存储格</a>
          <a href="#retrieve" class="text-gray-300 hover:text-monkey-yellow transition-colors duration-300 page-link" data-i18n="navRetrieve">远程取物</a>
          <a href="#adminLogin" id="adminNavLink" class="text-gray-300 hover:text-monkey-orange transition-colors duration-300 page-link hidden">管理员入口</a>
        </nav>
        
        <!-- 移动端菜单按钮 -->
        <button id="menuBtn" class="md:hidden text-gray-300 hover:text-monkey-yellow transition-colors">
          <i class="fa fa-bars text-2xl"></i>
        </button>
      </div>
    </div>
    
    <!-- 移动端导航菜单 -->
    <div id="mobileMenu" class="md:hidden hidden bg-monkey-gray/95 backdrop-blur-lg border-b border-monkey-gray/50">
      <div class="container mx-auto px-4 py-3 space-y-3">
        <a href="#dashboard" class="block py-2 text-gray-300 hover:text-monkey-yellow transition-colors duration-300 page-link" data-i18n="navDashboard">仪表板</a>
        <a href="#activate" class="block py-2 text-gray-300 hover:text-monkey-yellow transition-colors duration-300 page-link" data-i18n="navActivate">激活设备</a>
        <a href="#myPockets" class="block py-2 text-gray-300 hover:text-monkey-yellow transition-colors duration-300 page-link" data-i18n="navMyPockets">我的百宝袋</a>
        <a href="#items" class="block py-2 text-gray-300 hover:text-monkey-yellow transition-colors duration-300 page-link" data-i18n="navItems">我的物品</a>
        <a href="#storage" class="block py-2 text-gray-300 hover:text-monkey-yellow transition-colors duration-300 page-link" data-i18n="navStorage">购买存储格</a>
        <a href="#retrieve" class="block py-2 text-gray-300 hover:text-monkey-yellow transition-colors duration-300 page-link" data-i18n="navRetrieve">远程取物</a>
        <a href="#adminLogin" id="mobileAdminNavLink" class="block py-2 text-gray-300 hover:text-monkey-orange transition-colors duration-300 page-link hidden">管理员入口</a>
        <div id="mobileUserMenu" class="pt-2 border-t border-monkey-gray/50 hidden">
          <button id="mobileLogoutBtn" class="w-full text-left py-2 text-gray-300 hover:text-monkey-red transition-colors" data-i18n="userMenuLogout">退出登录</button>
        </div>
        <div id="mobileAdminMenu" class="pt-2 border-t border-monkey-gray/50 hidden">
          <button id="mobileAdminLogoutBtn" class="w-full text-left py-2 text-gray-300 hover:text-monkey-red transition-colors">退出管理后台</button>
        </div>
      </div>
    </div>
  </header>

  <!-- 登录/注册页面 -->
  <section id="authPage" class="min-h-screen pt-20 pb-20 flex items-center justify-center">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8">
      <div class="max-w-md mx-auto">
        <!-- 登录/注册切换 -->
        <div class="flex mb-8 bg-monkey-gray/30 rounded-full p-1">
          <button id="showLogin" class="flex-1 py-2 px-4 rounded-full font-medium transition-all bg-monkey-blue text-white" data-i18n="authLoginTab">登录</button>
          <button id="showRegister" class="flex-1 py-2 px-4 rounded-full font-medium transition-all text-gray-300 hover:text-white" data-i18n="authRegisterTab">注册</button>
        </div>
        
        <!-- 登录表单 -->
        <div id="loginForm" class="bg-monkey-gray/30 backdrop-blur-sm rounded-xl p-8 border border-monkey-gray/50">
          <h2 class="text-2xl font-bold mb-6 text-center" data-i18n="authLoginTitle">登录您的账户</h2>
          
          <form id="loginFormElement" class="space-y-4">
            <div>
              <label for="loginEmail" class="block text-sm font-medium text-gray-300 mb-1" data-i18n="authEmailLabel">邮箱地址</label>
              <input type="email" id="loginEmail" class="w-full bg-monkey-gray/50 border border-monkey-gray rounded-lg px-4 py-3 text-white focus:outline-none focus:border-monkey-blue transition-colors" placeholder="your@email.com" required>
            </div>
            
            <div>
              <label for="loginPassword" class="block text-sm font-medium text-gray-300 mb-1" data-i18n="authPasswordLabel">密码</label>
              <input type="password" id="loginPassword" class="w-full bg-monkey-gray/50 border border-monkey-gray rounded-lg px-4 py-3 text-white focus:outline-none focus:border-monkey-blue transition-colors" placeholder="••••••••" required>
            </div>
            
            <div class="flex items-center">
              <input type="checkbox" id="rememberMe" class="w-4 h-4 text-monkey-blue bg-monkey-gray border-monkey-gray rounded focus:ring-monkey-blue focus:ring-2">
              <label for="rememberMe" class="ml-2 text-sm text-gray-300" data-i18n="authRememberMe">记住我 (30天自动登录)</label>
            </div>
            
            <button type="submit" class="w-full bg-monkey-blue hover:bg-monkey-blue/90 text-white font-semibold py-3 px-4 rounded-lg transition-all duration-300 transform hover:scale-[1.02] glow">
              <span data-i18n="authLoginButton">登录</span>
            </button>
          </form>
          
          <div class="text-center mt-6">
            <button id="showAdminLogin" class="text-sm text-monkey-orange hover:text-monkey-orange/80 transition-colors">
              <i class="fa fa-lock mr-1"></i> <span data-i18n="adminLoginLink">管理员登录</span>
            </button>
          </div>
          
          <div id="loginError" class="hidden bg-monkey-red/20 border border-monkey-red/50 rounded-lg p-4 mt-6">
            <div class="flex items-start">
              <i class="fa fa-times-circle text-monkey-red text-xl mt-1 mr-3"></i>
              <div>
                <h4 class="font-medium text-monkey-red" data-i18n="authLoginErrorTitle">登录失败</h4>
                <p class="text-sm text-gray-300 mt-1" id="loginErrorMsg">邮箱或密码不正确</p>
              </div>
            </div>
          </div>
        </div>
        
        <!-- 注册表单 -->
        <div id="registerForm" class="bg-monkey-gray/30 backdrop-blur-sm rounded-xl p-8 border border-monkey-gray/50 hidden">
          <h2 class="text-2xl font-bold mb-6 text-center" data-i18n="authRegisterTitle">创建新账户</h2>
          
          <form id="registerFormElement" class="space-y-4">
            <div>
              <label for="registerUsername" class="block text-sm font-medium text-gray-300 mb-1" data-i18n="authUsernameLabel">用户名</label>
              <input type="text" id="registerUsername" class="w-full bg-monkey-gray/50 border border-monkey-gray rounded-lg px-4 py-3 text-white focus:outline-none focus:border-monkey-blue transition-colors" placeholder="monkeyfan123" required>
            </div>
            
            <div>
              <label for="registerEmail" class="block text-sm font-medium text-gray-300 mb-1" data-i18n="authEmailLabel">邮箱地址</label>
              <input type="email" id="registerEmail" class="w-full bg-monkey-gray/50 border border-monkey-gray rounded-lg px-4 py-3 text-white focus:outline-none focus:border-monkey-blue transition-colors" placeholder="your@email.com" required>
            </div>
            
            <div>
              <label for="registerPassword" class="block text-sm font-medium text-gray-300 mb-1" data-i18n="authPasswordLabel">密码</label>
              <input type="password" id="registerPassword" class="w-full bg-monkey-gray/50 border border-monkey-gray rounded-lg px-4 py-3 text-white focus:outline-none focus:border-monkey-blue transition-colors" placeholder="••••••••" required>
              <p class="text-xs text-gray-500 mt-1" data-i18n="authPasswordHint">密码至少8个字符，包含字母和数字</p>
            </div>
            
            <div>
              <label for="registerConfirmPassword" class="block text-sm font-medium text-gray-300 mb-1" data-i18n="authConfirmPasswordLabel">确认密码</label>
              <input type="password" id="registerConfirmPassword" class="w-full bg-monkey-gray/50 border border-monkey-gray rounded-lg px-4 py-3 text-white focus:outline-none focus:border-monkey-blue transition-colors" placeholder="••••••••" required>
            </div>
            
            <!-- 邮箱验证码 -->
            <div>
              <label for="registerVerificationCode" class="block text-sm font-medium text-gray-300 mb-1" data-i18n="authVerificationCodeLabel">邮箱验证码</label>
              <div class="flex space-x-2">
                <input type="text" id="registerVerificationCode" class="flex-1 bg-monkey-gray/50 border border-monkey-gray rounded-lg px-4 py-3 text-white focus:outline-none focus:border-monkey-blue transition-colors" placeholder="6位验证码" maxlength="6" required>
                <button type="button" id="sendVerificationCode" class="bg-monkey-blue hover:bg-monkey-blue/90 text-white font-medium px-4 py-3 rounded-lg transition-colors whitespace-nowrap" data-i18n="authSendCodeButton">发送验证码</button>
              </div>
              <p class="text-xs text-gray-500 mt-1" id="verificationTimer"></p>
            </div>
            
            <div class="flex items-center">
              <input type="checkbox" id="agreeTerms" class="w-4 h-4 text-monkey-blue bg-monkey-gray border-monkey-gray rounded focus:ring-monkey-blue focus:ring-2" required>
              <label for="agreeTerms" class="ml-2 text-sm text-gray-300" data-i18n="authAgreeTerms">我同意 <a href="#" class="text-monkey-blue hover:underline">服务条款</a> 和 <a href="#" class="text-monkey-blue hover:underline">隐私政策</a></label>
            </div>
            
            <button type="submit" class="w-full bg-monkey-green hover:bg-monkey-green/90 text-white font-semibold py-3 px-4 rounded-lg transition-all duration-300 transform hover:scale-[1.02] glow-green">
              <span data-i18n="authRegisterButton">注册</span>
            </button>
          </form>
          
          <div id="registerError" class="hidden bg-monkey-red/20 border border-monkey-red/50 rounded-lg p-4 mt-6">
            <div class="flex items-start">
              <i class="fa fa-times-circle text-monkey-red text-xl mt-1 mr-3"></i>
              <div>
                <h4 class="font-medium text-monkey-red" data-i18n="authRegisterErrorTitle">注册失败</h4>
                <p class="text-sm text-gray-300 mt-1" id="registerErrorMsg">请检查您的输入</p>
              </div>
            </div>
          </div>
          
          <div id="registerSuccess" class="hidden bg-monkey-green/20 border border-monkey-green/50 rounded-lg p-4 mt-6">
            <div class="flex items-start">
              <i class="fa fa-check-circle text-monkey-green text-xl mt-1 mr-3"></i>
              <div>
                <h4 class="font-medium text-monkey-green" data-i18n="authRegisterSuccessTitle">注册成功!</h4>
                <p class="text-sm text-gray-300 mt-1" data-i18n="authRegisterSuccessDesc">您的账户已创建，请登录以继续。</p>
              </div>
            </div>
          </div>
        </div>
        
        <!-- 管理员登录表单 -->
        <div id="adminLoginForm" class="bg-monkey-gray/30 backdrop-blur-sm rounded-xl p-8 border border-monkey-gray/50 hidden">
          <h2 class="text-2xl font-bold mb-6 text-center text-monkey-orange">管理员登录</h2>
          
          <form id="adminLoginFormElement" class="space-y-4">
            <div>
              <label for="adminUsername" class="block text-sm font-medium text-gray-300 mb-1">管理员账号</label>
              <input type="text" id="adminUsername" class="w-full bg-monkey-gray/50 border border-monkey-gray rounded-lg px-4 py-3 text-white focus:outline-none focus:border-monkey-orange transition-colors" placeholder="MonkeyKingdomCEO" required>
            </div>
            
            <div>
              <label for="adminPassword" class="block text-sm font-medium text-gray-300 mb-1">管理员密码</label>
              <input type="password" id="adminPassword" class="w-full bg-monkey-gray/50 border border-monkey-gray rounded-lg px-4 py-3 text-white focus:outline-none focus:border-monkey-orange transition-colors" placeholder="••••••••" required>
            </div>
            
            <button type="submit" class="w-full bg-monkey-orange hover:bg-monkey-orange/90 text-white font-semibold py-3 px-4 rounded-lg transition-all duration-300 transform hover:scale-[1.02] glow-orange">
              管理员登录
            </button>
          </form>
          
          <div class="text-center mt-6">
            <button id="backToUserLogin" class="text-sm text-monkey-blue hover:text-monkey-blue/80 transition-colors">
              <i class="fa fa-arrow-left mr-1"></i> <span data-i18n="backToUserLogin">返回用户登录</span>
            </button>
          </div>
          
          <div id="adminLoginError" class="hidden bg-monkey-red/20 border border-monkey-red/50 rounded-lg p-4 mt-6">
            <div class="flex items-start">
              <i class="fa fa-times-circle text-monkey-red text-xl mt-1 mr-3"></i>
              <div>
                <h4 class="font-medium text-monkey-red">管理员登录失败</h4>
                <p class="text-sm text-gray-300 mt-1" id="adminLoginErrorMsg">账号或密码不正确</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- 主内容区域 (登录后显示) -->
  <main id="mainContent" class="hidden">
    <!-- 仪表板 -->
    <section id="dashboard" class="pt-32 pb-20 page-section page-transition">
      <div class="container mx-auto px-4 sm:px-6 lg:px-8">
        <h1 class="text-[clamp(2rem,4vw,3rem)] font-extrabold leading-tight mb-6" data-i18n="dashboardTitle">
          欢迎回来, <span id="dashboardUsername" class="text-monkey-yellow text-shadow">用户</span>!
        </h1>
        <p class="text-lg md:text-xl text-gray-300 mb-8 max-w-3xl" data-i18n="dashboardDescription">
          这是您的Monkey Pocket仪表板，从这里管理您的所有百宝袋和物品。
        </p>
        
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-12">
          <!-- 统计卡片1 -->
          <div class="bg-monkey-gray/30 backdrop-blur-sm rounded-xl p-6 border border-monkey-gray/50">
            <div class="flex items-center mb-4">
              <div class="w-12 h-12 rounded-full bg-monkey-blue/20 flex items-center justify-center mr-4">
                <i class="fa fa-briefcase text-monkey-blue text-2xl"></i>
              </div>
              <div>
                <h3 class="text-xl font-bold" id="totalPocketsCount">0</h3>
                <p class="text-gray-400 text-sm" data-i18n="dashboardTotalPockets">百宝袋总数</p>
              </div>
            </div>
          </div>
          
          <!-- 统计卡片2 -->
          <div class="bg-monkey-gray/30 backdrop-blur-sm rounded-xl p-6 border border-monkey-gray/50">
            <div class="flex items-center mb-4">
              <div class="w-12 h-12 rounded-full bg-monkey-yellow/20 flex items-center justify-center mr-4">
                <i class="fa fa-box text-monkey-yellow text-2xl"></i>
              </div>
              <div>
                <h3 class="text-xl font-bold" id="totalItemsCount">0</h3>
                <p class="text-gray-400 text-sm" data-i18n="dashboardTotalItems">物品总数</p>
              </div>
            </div>
          </div>
          
          <!-- 统计卡片3 -->
          <div class="bg-monkey-gray/30 backdrop-blur-sm rounded-xl p-6 border border-monkey-gray/50">
            <div class="flex items-center mb-4">
              <div class="w-12 h-12 rounded-full bg-monkey-green/20 flex items-center justify-center mr-4">
                <i class="fa fa-coins text-monkey-green text-2xl"></i>
              </div>
              <div>
                <h3 class="text-xl font-bold" id="totalStorageSlots">0</h3>
                <p class="text-gray-400 text-sm" data-i18n="dashboardTotalStorage">总存储格</p>
              </div>
            </div>
          </div>
        </div>
        
        <!-- 快速操作 -->
        <div class="mb-12">
          <h2 class="text-2xl font-bold mb-6" data-i18n="dashboardQuickActions">快速操作</h2>
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
            <a href="#activate" class="bg-monkey-blue/10 hover:bg-monkey-blue/20 border border-monkey-blue/30 rounded-xl p-6 flex flex-col items-center justify-center transition-all duration-300 transform hover:scale-105">
              <div class="w-14 h-14 rounded-full bg-monkey-blue/20 flex items-center justify-center mb-4">
                <i class="fa fa-plus text-monkey-blue text-2xl"></i>
              </div>
              <h3 class="font-medium text-center" data-i18n="dashboardAddPocket">添加百宝袋</h3>
            </a>
            
            <a href="#items" class="bg-monkey-yellow/10 hover:bg-monkey-yellow/20 border border-monkey-yellow/30 rounded-xl p-6 flex flex-col items-center justify-center transition-all duration-300 transform hover:scale-105">
              <div class="w-14 h-14 rounded-full bg-monkey-yellow/20 flex items-center justify-center mb-4">
                <i class="fa fa-box-open text-monkey-yellow text-2xl"></i>
              </div>
              <h3 class="font-medium text-center" data-i18n="dashboardAddItem">添加物品</h3>
            </a>
            
            <a href="#retrieve" class="bg-monkey-green/10 hover:bg-monkey-green/20 border border-monkey-green/30 rounded-xl p-6 flex flex-col items-center justify-center transition-all duration-300 transform hover:scale-105">
              <div class="w-14 h-14 rounded-full bg-monkey-green/20 flex items-center justify-center mb-4">
                <i class="fa fa-download text-monkey-green text-2xl"></i>
              </div>
              <h3 class="font-medium text-center" data-i18n="dashboardRetrieve">远程取物</h3>
            </a>
            
            <a href="#storage" class="bg-monkey-purple/10 hover:bg-monkey-purple/20 border border-monkey-purple/30 rounded-xl p-6 flex flex-col items-center justify-center transition-all duration-300 transform hover:scale-105">
              <div class="w-14 h-14 rounded-full bg-monkey-purple/20 flex items-center justify-center mb-4">
                <i class="fa fa-shopping-cart text-monkey-purple text-2xl"></i>
              </div>
              <h3 class="font-medium text-center" data-i18n="dashboardBuyStorage">购买存储格</h3>
            </a>
          </div>
        </div>
        
        <!-- 最近活动 -->
        <div>
          <h2 class="text-2xl font-bold mb-6" data-i18n="dashboardRecentActivity">最近活动</h2>
          <div class="bg-monkey-gray/30 backdrop-blur-sm rounded-xl p-6 border border-monkey-gray/50">
            <div id="recentActivityList" class="space-y-4">
              <div class="text-center py-8 text-gray-500">
                <i class="fa fa-history text-3xl mb-3"></i>
                <p data-i18n="dashboardNoActivity">暂无活动记录</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- 激活设备区域 -->
    <section id="activate" class="py-20 bg-monkey-dark page-section page-transition">
      <div class="container mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center mb-16">
          <h2 class="text-[clamp(1.8rem,3vw,2.5rem)] font-bold mb-4" data-i18n="activateTitle">激活你的<span class="text-monkey-yellow">Monkey Pocket</span></h2>
          <p class="text-gray-400 max-w-2xl mx-auto" data-i18n="activateDescription">请按照以下两个步骤完成设备激活</p>
        </div>
        
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
          <!-- 步骤1：激活码激活 -->
          <div class="bg-monkey-gray/30 backdrop-blur-sm rounded-xl p-6 border border-monkey-gray/50">
            <div class="flex items-center mb-6">
              <div class="w-10 h-10 rounded-full bg-monkey-blue flex items-center justify-center mr-4">
                <span class="text-white font-bold">1</span>
              </div>
              <h3 class="text-xl font-semibold" data-i18n="activateStep1">输入激活码和密码</h3>
            </div>
            
            <div class="space-y-4">
              <p class="text-sm text-gray-400" data-i18n="activateStep1Desc">请在您的Monkey Pocket包装盒内找到激活码卡片，输入下方以激活您的设备。</p>
              
              <div id="activationForm">
                <div class="mb-4">
                  <label for="activationCode" class="block text-sm font-medium text-gray-300 mb-1" data-i18n="activateCodeLabel">激活码</label>
                  <input type="text" id="activationCode" class="w-full bg-monkey-gray/50 border border-monkey-gray rounded-lg px-4 py-3 text-white focus:outline-none focus:border-monkey-blue transition-colors" placeholder="例如: MK-7890-ABCD-1234" maxlength="19">
                  <p class="text-xs text-gray-500 mt-1" data-i18n="activateCodeHint">激活码格式: MK-XXXX-XXXX-XXXX (X为字母或数字)</p>
                </div>
                
                <div class="mb-4">
                  <label for="activationPassword" class="block text-sm font-medium text-gray-300 mb-1">激活密码</label>
                  <input type="password" id="activationPassword" class="w-full bg-monkey-gray/50 border border-monkey-gray rounded-lg px-4 py-3 text-white focus:outline-none focus:border-monkey-blue transition-colors" placeholder="输入激活密码">
                  <p class="text-xs text-gray-500 mt-1">请在Monkey Pocket包装盒内找到激活密码</p>
                </div>
                
                <div class="mb-4">
                  <label for="pocketName" class="block text-sm font-medium text-gray-300 mb-1" data-i18n="activatePocketNameLabel">百宝袋名称</label>
                  <input type="text" id="pocketName" class="w-full bg-monkey-gray/50 border border-monkey-gray rounded-lg px-4 py-3 text-white focus:outline-none focus:border-monkey-blue transition-colors" placeholder="例如: 我的魔法袋" data-i18n-placeholder="activatePocketNamePlaceholder">
                </div>
                
                <button id="activateDeviceBtn" class="w-full bg-monkey-blue hover:bg-monkey-blue/90 text-white font-semibold py-3 px-4 rounded-lg transition-all duration-300 transform hover:scale-[1.02] glow">
                  <span data-i18n="activateButton">激活设备</span>
                </button>
              </div>
              
              <div id="activationSuccess" class="hidden bg-monkey-green/20 border border-monkey-green/50 rounded-lg p-4 mt-4">
                <div class="flex items-start">
                  <i class="fa fa-check-circle text-monkey-green text-xl mt-1 mr-3"></i>
                  <div>
                    <h4 class="font-medium text-monkey-green" data-i18n="activateSuccessTitle">激活成功!</h4>
                    <p class="text-sm text-gray-300 mt-1" data-i18n="activateSuccessDesc">您的Monkey Pocket已成功激活。请继续步骤2以完成设置。</p>
                  </div>
                </div>
              </div>
              
              <div id="activationError" class="hidden bg-monkey-red/20 border border-monkey-red/50 rounded-lg p-4 mt-4">
                <div class="flex items-start">
                  <i class="fa fa-times-circle text-monkey-red text-xl mt-1 mr-3"></i>
                  <div>
                    <h4 class="font-medium text-monkey-red" data-i18n="activateErrorTitle">激活失败</h4>
                    <p class="text-sm text-gray-300 mt-1" id="activationErrorMsg">激活码无效或已被使用。请检查后重试。</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- 步骤2：IP地址绑定与实名认证 -->
          <div class="bg-monkey-gray/30 backdrop-blur-sm rounded-xl p-6 border border-monkey-gray/50">
            <div class="flex items-center mb-6">
              <div class="w-10 h-10 rounded-full bg-monkey-yellow flex items-center justify-center mr-4">
                <span class="text-monkey-darker font-bold">2</span>
              </div>
              <h3 class="text-xl font-semibold" data-i18n="activateStep2">绑定IP地址与实名认证</h3>
            </div>
            
            <div class="space-y-4">
              <p class="text-sm text-gray-400" data-i18n="activateStep2Desc">为了安全起见，请绑定您家庭的IP地址并进行香港身份证实名认证。</p>
              
              <div id="ipBindingForm" class="space-y-4">
                <div>
                  <label for="ipAddress" class="block text-sm font-medium text-gray-300 mb-1" data-i18n="ipAddressLabel">家庭IP地址</label>
                  <input type="text" id="ipAddress" class="w-full bg-monkey-gray/50 border border-monkey-gray rounded-lg px-4 py-3 text-white focus:outline-none focus:border-monkey-blue transition-colors" placeholder="例如: 192.168.1.1">
                  <button id="detectIPBtn" class="mt-2 text-sm text-monkey-blue hover:text-monkey-blue/80 transition-colors" data-i18n="detectIPButton">自动检测IP地址</button>
                </div>
                
                <div>
                  <label for="fullName" class="block text-sm font-medium text-gray-300 mb-1" data-i18n="fullNameLabel">姓名</label>
                  <input type="text" id="fullName" class="w-full bg-monkey-gray/50 border border-monkey-gray rounded-lg px-4 py-3 text-white focus:outline-none focus:border-monkey-blue transition-colors" placeholder="请输入您的全名" data-i18n-placeholder="fullNamePlaceholder">
                </div>
                
                <div>
                  <label for="hkid" class="block text-sm font-medium text-gray-300 mb-1" data-i18n="hkidLabel">香港身份证号码</label>
                  <input type="text" id="hkid" class="w-full bg-monkey-gray/50 border border-monkey-gray rounded-lg px-4 py-3 text-white focus:outline-none focus:border-monkey-blue transition-colors" placeholder="例如: A123456(7)" maxlength="11">
                  <p class="text-xs text-gray-500 mt-1" data-i18n="hkidHint">格式: 1个字母 + 6位数字 + 括号内1位校验码</p>
                </div>
                
                <button id="bindIPBtn" class="w-full bg-monkey-yellow hover:bg-monkey-yellow/90 text-monkey-darker font-semibold py-3 px-4 rounded-lg transition-all duration-300 transform hover:scale-[1.02]">
                  <span data-i18n="bindIPButton">绑定IP地址</span>
                </button>
              </div>
              
              <div id="ipBindingSuccess" class="hidden bg-monkey-green/20 border border-monkey-green/50 rounded-lg p-4 mt-4">
                <div class="flex items-start">
                  <i class="fa fa-check-circle text-monkey-green text-xl mt-1 mr-3"></i>
                  <div>
                    <h4 class="font-medium text-monkey-green" data-i18n="ipBindingSuccessTitle">绑定成功!</h4>
                    <p class="text-sm text-gray-300 mt-1" data-i18n="ipBindingSuccessDesc">您的IP地址已成功绑定，实名认证已完成。现在可以开始使用Monkey Pocket了!</p>
                  </div>
                </div>
              </div>
              
              <div id="ipBindingError" class="hidden bg-monkey-red/20 border border-monkey-red/50 rounded-lg p-4 mt-4">
                <div class="flex items-start">
                  <i class="fa fa-times-circle text-monkey-red text-xl mt-1 mr-3"></i>
                  <div>
                    <h4 class="font-medium text-monkey-red" data-i18n="ipBindingErrorTitle">绑定失败</h4>
                    <p class="text-sm text-gray-300 mt-1" id="ipBindingErrorMsg">香港身份证号码格式不正确。请检查后重试。</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- 我的百宝袋区域 -->
    <section id="myPockets" class="py-20 page-section page-transition">
      <div class="container mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center mb-16">
          <h2 class="text-[clamp(1.8rem,3vw,2.5rem)] font-bold mb-4" data-i18n="myPocketsTitle">我的<span class="text-monkey-yellow">百宝袋</span></h2>
          <p class="text-gray-400 max-w-2xl mx-auto" data-i18n="myPocketsDescription">管理您所有的Monkey Pocket设备</p>
        </div>
        
        <div id="pocketsListContainer">
          <div id="noPocketsMessage" class="text-center py-12 bg-monkey-gray/30 backdrop-blur-sm rounded-xl border border-monkey-gray/50">
            <i class="fa fa-briefcase text-4xl text-gray-500 mb-3"></i>
            <p class="text-gray-400 text-lg mb-6" data-i18n="noPocketsMessage">您尚未添加任何Monkey Pocket</p>
            <a href="#activate" class="inline-block bg-monkey-blue hover:bg-monkey-blue/90 text-white font-semibold py-3 px-6 rounded-lg transition-all duration-300 transform hover:scale-105 glow">
              <span data-i18n="addFirstPocketButton">添加第一个百宝袋</span>
            </a>
          </div>
          
          <div id="pocketsList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 hidden">
            <!-- 百宝袋卡片将通过JavaScript动态添加 -->
          </div>
        </div>
      </div>
    </section>

    <!-- 物品管理区域 -->
    <section id="items" class="py-20 bg-monkey-dark page-section page-transition">
      <div class="container mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center mb-16">
          <h2 class="text-[clamp(1.8rem,3vw,2.5rem)] font-bold mb-4" data-i18n="itemsTitle">管理你的<span class="text-monkey-yellow">物品</span></h2>
          <p class="text-gray-400 max-w-2xl mx-auto" data-i18n="itemsDescription">添加、组织和管理您的个人物品</p>
          
          <div class="mt-6 flex flex-wrap justify-center gap-4">
            <div class="inline-flex items-center bg-monkey-gray/50 rounded-full px-4 py-2">
              <i class="fa fa-box text-monkey-yellow mr-2"></i>
              <span class="text-sm" data-i18n="storageStatus">已使用 <span id="usedSlots">0</span>/<span id="totalSlots">0</span> 存储格</span>
            </div>
            
            <div id="pocketSelectorContainer" class="hidden">
              <select id="pocketSelector" class="bg-monkey-gray/50 border border-monkey-gray rounded-lg px-4 py-2 text-white focus:outline-none focus:border-monkey-blue transition-colors">
                <option value="" data-i18n="selectPocketOption">选择百宝袋</option>
              </select>
            </div>
          </div>
        </div>
        
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
          <!-- 添加物品表单 -->
          <div class="lg:col-span-1 bg-monkey-gray/30 backdrop-blur-sm rounded-xl p-6 border border-monkey-gray/50">
            <h3 class="text-xl font-semibold mb-6" data-i18n="addItemTitle">添加新物品</h3>
            
            <form id="itemForm" class="space-y-4">
              <div>
                <label for="itemName" class="block text-sm font-medium text-gray-300 mb-1" data-i18n="itemNameLabel">物品名称</label>
                <input type="text" id="itemName" class="w-full bg-monkey-gray/50 border border-monkey-gray rounded-lg px-4 py-2 text-white focus:outline-none focus:border-monkey-blue transition-colors" placeholder="例如: 笔记本电脑、雨伞" data-i18n-placeholder="itemNamePlaceholder">
              </div>
              
              <div>
                <label for="itemCategory" class="block text-sm font-medium text-gray-300 mb-1" data-i18n="itemCategoryLabel">类别</label>
                <select id="itemCategory" class="w-full bg-monkey-gray/50 border border-monkey-gray rounded-lg px-4 py-2 text-white focus:outline-none focus:border-monkey-blue transition-colors">
                  <option value="electronics" data-i18n="categoryElectronics">电子产品</option>
                  <option value="clothing" data-i18n="categoryClothing">衣物</option>
                  <option value="accessories" data-i18n="categoryAccessories">配件</option>
                  <option value="documents" data-i18n="categoryDocuments">文件</option>
                  <option value="personal" data-i18n="categoryPersonal">个人物品</option>
                  <option value="other" data-i18n="categoryOther">其他</option>
                </select>
              </div>
              
              <div>
                <label for="itemDescription" class="block text-sm font-medium text-gray-300 mb-1" data-i18n="itemDescriptionLabel">描述</label>
                <textarea id="itemDescription" rows="3" class="w-full bg-monkey-gray/50 border border-monkey-gray rounded-lg px-4 py-2 text-white focus:outline-none focus:border-monkey-blue transition-colors" placeholder="物品的简要描述" data-i18n-placeholder="itemDescriptionPlaceholder"></textarea>
              </div>
              
              <div id="targetPocketContainer">
                <label for="targetPocket" class="block text-sm font-medium text-gray-300 mb-1" data-i18n="targetPocketLabel">存入百宝袋</label>
                <select id="targetPocket" class="w-full bg-monkey-gray/50 border border-monkey-gray rounded-lg px-4 py-2 text-white focus:outline-none focus:border-monkey-blue transition-colors">
                  <option value="" data-i18n="selectPocketOption">选择百宝袋</option>
                </select>
              </div>
              
              <div class="pt-2">
                <button type="submit" id="addItemBtn" class="w-full bg-monkey-blue hover:bg-monkey-blue/90 text-white font-semibold py-2 px-4 rounded-lg transition-all duration-300 transform hover:scale-[1.02] glow">
                  <span data-i18n="addItemButton">添加物品</span>
                </button>
              </div>
              
              <div id="storageFullError" class="hidden bg-monkey-red/20 border border-monkey-red/50 rounded-lg p-3 mt-2">
                <div class="flex items-start">
                  <i class="fa fa-exclamation-triangle text-monkey-red text-sm mt-0.5 mr-2"></i>
                  <div>
                    <p class="text-sm text-gray-300" data-i18n="storageFullError">存储格已满！请购买更多存储格以添加新物品。</p>
                  </div>
                </div>
              </div>
            </form>
          </div>
          
          <!-- 物品列表 -->
          <div class="lg:col-span-2 bg-monkey-gray/30 backdrop-blur-sm rounded-xl p-6 border border-monkey-gray/50">
            <div class="flex justify-between items-center mb-6">
              <h3 class="text-xl font-semibold" data-i18n="itemsListTitle">你的物品</h3>
              <div class="text-sm text-gray-400" id="itemCount" data-i18n="itemCount">0 个物品</div>
            </div>
            
            <div class="overflow-y-auto max-h-[500px] scrollbar-hide pr-2">
              <div id="itemsList" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <!-- 物品将通过JavaScript动态添加 -->
              </div>
              
              <!-- 空状态 -->
              <div id="emptyState" class="text-center py-12 text-gray-500">
                <i class="fa fa-inbox text-4xl mb-3"></i>
                <p data-i18n="emptyStateText">尚未添加任何物品。开始添加您的物品吧！</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- 购买存储格区域 -->
    <section id="storage" class="py-20 page-section page-transition">
      <div class="container mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center mb-16">
          <h2 class="text-[clamp(1.8rem,3vw,2.5rem)] font-bold mb-4" data-i18n="storageTitle">购买<span class="text-monkey-yellow">存储格</span></h2>
          <p class="text-gray-400 max-w-2xl mx-auto" data-i18n="storageDescription">购买更多存储格以添加更多物品！</p>
        </div>
        
        <div id="pocketSelectorForPurchase" class="mb-8 max-w-md mx-auto hidden">
          <label for="purchasePocketSelector" class="block text-sm font-medium text-gray-300 mb-2 text-center" data-i18n="selectPocketForPurchaseLabel">选择要购买存储格的百宝袋</label>
          <select id="purchasePocketSelector" class="w-full bg-monkey-gray/50 border border-monkey-gray rounded-lg px-4 py-3 text-white focus:outline-none focus:border-monkey-blue transition-colors">
            <option value="" data-i18n="selectPocketOption">选择百宝袋</option>
          </select>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
          <!-- 套餐1 -->
          <div class="bg-monkey-gray/30 backdrop-blur-sm rounded-xl p-6 border border-monkey-gray/50 hover:border-monkey-blue/50 transition-all duration-300 transform hover:-translate-y-1">
            <div class="text-center mb-6">
              <h3 class="text-xl font-semibold mb-2" data-i18n="plan1Title">基础套餐</h3>
              <div class="flex justify-center items-baseline">
                <span class="text-3xl font-bold">$100</span>
                <span class="text-gray-400 ml-1" data-i18n="planPriceUnit">HKD</span>
              </div>
            </div>
            
            <ul class="space-y-3 mb-8">
              <li class="flex items-center">
                <i class="fa fa-check text-monkey-green mr-3"></i>
                <span data-i18n="plan1Feature1">5 个额外存储格</span>
              </li>
              <li class="flex items-center">
                <i class="fa fa-check text-monkey-green mr-3"></i>
                <span data-i18n="plan1Feature2">永久使用</span>
              </li>
              <li class="flex items-center">
                <i class="fa fa-check text-monkey-green mr-3"></i>
                <span data-i18n="plan1Feature3">即时生效</span>
              </li>
            </ul>
            
            <button class="w-full bg-monkey-blue hover:bg-monkey-blue/90 text-white font-semibold py-3 px-4 rounded-lg transition-all duration-300 transform hover:scale-[1.02] glow purchase-btn" data-plan="5" data-price="100">
              <span data-i18n="purchaseButton">立即购买</span>
            </button>
          </div>
          
          <!-- 套餐2 -->
          <div class="bg-monkey-gray/30 backdrop-blur-sm rounded-xl p-6 border border-monkey-gray/50 hover:border-monkey-yellow/50 transition-all duration-300 transform hover:-translate-y-1 relative">
            <div class="absolute -top-3 left-1/2 transform -translate-x-1/2 bg-monkey-yellow text-monkey-darker px-3 py-1 rounded-full text-sm font-semibold" data-i18n="popularLabel">最受欢迎</div>
            
            <div class="text-center mb-6">
              <h3 class="text-xl font-semibold mb-2" data-i18n="plan2Title">进阶套餐</h3>
              <div class="flex justify-center items-baseline">
                <span class="text-3xl font-bold">$200</span>
                <span class="text-gray-400 ml-1" data-i18n="planPriceUnit">HKD</span>
              </div>
            </div>
            
            <ul class="space-y-3 mb-8">
              <li class="flex items-center">
                <i class="fa fa-check text-monkey-green mr-3"></i>
                <span data-i18n="plan2Feature1">13 个额外存储格</span>
              </li>
              <li class="flex items-center">
                <i class="fa fa-check text-monkey-green mr-3"></i>
                <span data-i18n="plan2Feature2">永久使用</span>
              </li>
              <li class="flex items-center">
                <i class="fa fa-check text-monkey-green mr-3"></i>
                <span data-i18n="plan2Feature3">节省 $60 (比单买5格套餐)</span>
              </li>
            </ul>
            
            <button class="w-full bg-monkey-yellow hover:bg-monkey-yellow/90 text-monkey-darker font-semibold py-3 px-4 rounded-lg transition-all duration-300 transform hover:scale-[1.02] purchase-btn" data-plan="13" data-price="200">
              <span data-i18n="purchaseButton">立即购买</span>
            </button>
          </div>
          
          <!-- 套餐3 -->
          <div class="bg-monkey-gray/30 backdrop-blur-sm rounded-xl p-6 border border-monkey-gray/50 hover:border-monkey-green/50 transition-all duration-300 transform hover:-translate-y-1">
            <div class="text-center mb-6">
              <h3 class="text-xl font-semibold mb-2" data-i18n="plan3Title">高级套餐</h3>
              <div class="flex justify-center items-baseline">
                <span class="text-3xl font-bold">$350</span>
                <span class="text-gray-400 ml-1" data-i18n="planPriceUnit">HKD</span>
              </div>
            </div>
            
            <ul class="space-y-3 mb-8">
              <li class="flex items-center">
                <i class="fa fa-check text-monkey-green mr-3"></i>
                <span data-i18n="plan3Feature1">30 个额外存储格</span>
              </li>
              <li class="flex items-center">
                <i class="fa fa-check text-monkey-green mr-3"></i>
                <span data-i18n="plan3Feature2">永久使用</span>
              </li>
              <li class="flex items-center">
                <i class="fa fa-check text-monkey-green mr-3"></i>
                <span data-i18n="plan3Feature3">节省 $250 (比单买5格套餐)</span>
              </li>
            </ul>
            
            <button class="w-full bg-monkey-green hover:bg-monkey-green/90 text-white font-semibold py-3 px-4 rounded-lg transition-all duration-300 transform hover:scale-[1.02] glow-green purchase-btn" data-plan="30" data-price="350">
              <span data-i18n="purchaseButton">立即购买</span>
            </button>
          </div>
        </div>
        
        <!-- 购买确认模态框 -->
        <div id="purchaseModal" class="hidden fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4">
          <div class="bg-monkey-darker rounded-xl max-w-md w-full p-6 border border-monkey-gray/50">
            <div class="flex justify-between items-center mb-6">
              <h3 class="text-xl font-semibold" data-i18n="purchaseModalTitle">确认购买</h3>
              <button id="closePurchaseModal" class="text-gray-400 hover:text-white">
                <i class="fa fa-times"></i>
              </button>
            </div>
            
            <div class="mb-6">
              <p class="text-gray-300 mb-2" data-i18n="purchaseModalDesc">您即将购买：</p>
              <div class="bg-monkey-gray/50 rounded-lg p-4 mb-4">
                <h4 class="font-semibold text-lg" id="purchasePlanName">基础套餐</h4>
                <p class="text-gray-400" id="purchasePlanDetails">5 个额外存储格</p>
                <p class="text-monkey-yellow font-bold text-xl mt-2" id="purchasePlanPrice">$100 HKD</p>
                <p class="text-sm text-gray-400 mt-2" id="purchasePocketInfo">百宝袋: <span id="purchasePocketName">未选择</span></p>
              </div>
              
              <p class="text-sm text-gray-400" data-i18n="purchaseModalNote">购买后存储格将立即添加到您选择的百宝袋，永久有效。</p>
            </div>
            
            <div class="flex space-x-4">
              <button id="confirmPurchase" class="flex-1 bg-monkey-green hover:bg-monkey-green/90 text-white font-semibold py-3 px-4 rounded-lg transition-all duration-300">
                <span data-i18n="confirmPurchaseButton">确认购买</span>
              </button>
              <button id="cancelPurchase" class="flex-1 bg-monkey-gray hover:bg-monkey-gray/70 text-white font-semibold py-3 px-4 rounded-lg transition-all duration-300">
                <span data-i18n="cancelPurchaseButton">取消</span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- 远程取物区域 -->
    <section id="retrieve" class="py-20 bg-monkey-dark page-section page-transition">
      <div class="container mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center mb-16">
          <h2 class="text-[clamp(1.8rem,3vw,2.5rem)] font-bold mb-4" data-i18n="retrieveTitle">远程<span class="text-monkey-yellow">取物</span></h2>
          <p class="text-gray-400 max-w-2xl mx-auto" data-i18n="retrieveDescription">外出时忘记带物品？远程从您的Monkey Pocket中取出！</p>
          <p class="text-sm text-monkey-yellow/80 mt-2" data-i18n="retrieveWarning">注意：每次远程取物会消耗一个存储格！</p>
        </div>
        
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
          <!-- 远程取物控制面板 -->
          <div class="bg-monkey-gray/30 backdrop-blur-sm rounded-xl p-6 border border-monkey-gray/50">
            <h3 class="text-xl font-semibold mb-6" data-i18n="retrievePanelTitle">远程取物控制面板</h3>
            
            <div class="space-y-6">
              <div id="retrievePocketSelectorContainer" class="hidden">
                <label for="retrievePocketSelector" class="block text-sm font-medium text-gray-300 mb-2" data-i18n="selectPocketForRetrieveLabel">选择百宝袋</label>
                <select id="retrievePocketSelector" class="w-full bg-monkey-gray/50 border border-monkey-gray rounded-lg px-4 py-3 text-white focus:outline-none focus:border-monkey-blue transition-colors">
                  <option value="" data-i18n="selectPocketOption">选择百宝袋</option>
                </select>
              </div>
              
              <div class="bg-monkey-gray/50 rounded-lg p-4">
                <div class="flex items-center mb-4">
                  <div class="w-10 h-10 rounded-full bg-monkey-blue/20 flex items-center justify-center mr-3">
                    <i class="fa fa-wifi text-monkey-blue"></i>
                  </div>
                  <div>
                    <h4 class="font-medium" data-i18n="connectionStatusTitle">连接状态</h4>
                    <p class="text-sm text-gray-400" data-i18n="connectionStatusDesc">与您的Monkey Pocket连接</p>
                  </div>
                </div>
                
                <div class="flex items-center justify-between">
                  <span class="text-gray-300" data-i18n="monkeyPocketStatus">Monkey Pocket状态:</span>
                  <div id="connectionStatus" class="flex items-center">
                    <div class="w-3 h-3 rounded-full bg-gray-500 mr-2"></div>
                    <span class="text-gray-400 font-medium" data-i18n="notConnected">未连接</span>
                  </div>
                </div>
              </div>
              
              <div id="selectedItemsForRetrieval" class="bg-monkey-gray/50 rounded-lg p-4 min-h-[120px]">
                <p class="text-gray-500 text-center py-4" data-i18n="selectItemsPrompt">请从右侧选择要取出的物品</p>
              </div>
              
              <div class="bg-monkey-yellow/10 border border-monkey-yellow/30 rounded-lg p-4">
                <div class="flex items-start">
                  <i class="fa fa-exclamation-triangle text-monkey-yellow mt-1 mr-3"></i>
                  <div>
                    <h4 class="font-medium text-monkey-yellow" data-i18n="retrieveCostTitle">取物消耗</h4>
                    <p class="text-sm text-gray-300 mt-1" data-i18n="retrieveCostDesc">本次取物将消耗 <span id="retrieveCostCount" class="font-bold">0</span> 个存储格。取物后存储格总数将相应减少。</p>
                  </div>
                </div>
              </div>
              
              <div class="flex space-x-4">
                <button id="retrieveItemsBtn" class="flex-1 bg-monkey-blue hover:bg-monkey-blue/90 text-white font-semibold py-3 px-4 rounded-lg transition-all duration-300 transform hover:scale-[1.02] glow disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                  <i class="fa fa-download mr-2"></i>
                  <span data-i18n="retrieveButton">取出物品</span>
                </button>
                <button id="clearSelectionBtn" class="flex-1 bg-monkey-gray hover:bg-monkey-gray/70 text-white font-semibold py-3 px-4 rounded-lg transition-all duration-300">
                  <i class="fa fa-times mr-2"></i>
                  <span data-i18n="clearSelectionButton">清空选择</span>
                </button>
              </div>
              
              <div id="retrieveSuccess" class="hidden bg-monkey-green/20 border border-monkey-green/50 rounded-lg p-4">
                <div class="flex items-start">
                  <i class="fa fa-check-circle text-monkey-green text-xl mt-1 mr-3"></i>
                  <div>
                    <h4 class="font-medium text-monkey-green" data-i18n="retrieveSuccessTitle">取出成功!</h4>
                    <p class="text-sm text-gray-300 mt-1" data-i18n="retrieveSuccessDesc">您的物品已从Monkey Pocket中取出。请检查您的Monkey Pocket。</p>
                  </div>
                </div>
              </div>
              
              <div id="retrieveError" class="hidden bg-monkey-red/20 border border-monkey-red/50 rounded-lg p-4">
                <div class="flex items-start">
                  <i class="fa fa-times-circle text-monkey-red text-xl mt-1 mr-3"></i>
                  <div>
                    <h4 class="font-medium text-monkey-red" data-i18n="retrieveErrorTitle">取出失败</h4>
                    <p class="text-sm text-gray-300 mt-1" data-i18n="retrieveErrorDesc">无法从Monkey Pocket中取出物品。请检查连接后重试。</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- 可取出物品列表 -->
          <div class="bg-monkey-gray/30 backdrop-blur-sm rounded-xl p-6 border border-monkey-gray/50">
            <div class="flex justify-between items-center mb-6">
              <h3 class="text-xl font-semibold" data-i18n="availableItemsTitle">可取出物品</h3>
              <div class="text-sm text-gray-400" id="availableItemsCount" data-i18n="availableItemsCount">0 个物品可用</div>
            </div>
            
            <div class="overflow-y-auto max-h-[500px] scrollbar-hide pr-2">
              <div id="availableItemsList" class="space-y-4">
                <!-- 物品将通过JavaScript动态添加 -->
              </div>
              
              <div id="noAvailableItems" class="text-center py-12 text-gray-500">
                <i class="fa fa-box-open text-4xl mb-3"></i>
                <p data-i18n="noAvailableItemsText">暂无可用物品。请先添加物品到您的Monkey Pocket。</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- 管理后台区域 -->
  <main id="adminContent" class="hidden">
    <!-- 管理员仪表板 -->
    <section id="adminDashboard" class="pt-32 pb-20 page-section page-transition">
      <div class="container mx-auto px-4 sm:px-6 lg:px-8">
        <h1 class="text-[clamp(2rem,4vw,3rem)] font-extrabold leading-tight mb-6 gradient-text">
          Monkey Pocket <span class="text-monkey-orange">管理后台</span>
        </h1>
        <p class="text-lg md:text-xl text-gray-300 mb-8 max-w-3xl">
          欢迎使用Monkey Pocket管理后台。在这里您可以管理激活码、查看用户信息和监控系统状态。
        </p>
        
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-12">
          <!-- 统计卡片1 -->
          <div class="bg-monkey-gray/30 backdrop-blur-sm rounded-xl p-6 border border-monkey-gray/50">
            <div class="flex items-center mb-4">
              <div class="w-12 h-12 rounded-full bg-monkey-orange/20 flex items-center justify-center mr-4">
                <i class="fa fa-key text-monkey-orange text-2xl"></i>
              </div>
              <div>
                <h3 class="text-xl font-bold" id="adminTotalCodes">0</h3>
                <p class="text-gray-400 text-sm">激活码总数</p>
              </div>
            </div>
          </div>
          
          <!-- 统计卡片2 -->
          <div class="bg-monkey-gray/30 backdrop-blur-sm rounded-xl p-6 border border-monkey-gray/50">
            <div class="flex items-center mb-4">
              <div class="w-12 h-12 rounded-full bg-monkey-blue/20 flex items-center justify-center mr-4">
                <i class="fa fa-users text-monkey-blue text-2xl"></i>
              </div>
              <div>
                <h3 class="text-xl font-bold" id="adminTotalUsers">0</h3>
                <p class="text-gray-400 text-sm">注册用户总数</p>
              </div>
            </div>
          </div>
          
          <!-- 统计卡片3 -->
          <div class="bg-monkey-gray/30 backdrop-blur-sm rounded-xl p-6 border border-monkey-gray/50">
            <div class="flex items-center mb-4">
              <div class="w-12 h-12 rounded-full bg-monkey-green/20 flex items-center justify-center mr-4">
                <i class="fa fa-briefcase text-monkey-green text-2xl"></i>
              </div>
              <div>
                <h3 class="text-xl font-bold" id="adminActivePockets">0</h3>
                <p class="text-gray-400 text-sm">已激活百宝袋</p>
              </div>
            </div>
          </div>
          
          <!-- 统计卡片4 -->
          <div class="bg-monkey-gray/30 backdrop-blur-sm rounded-xl p-6 border border-monkey-gray/50">
            <div class="flex items-center mb-4">
              <div class="w-12 h-12 rounded-full bg-monkey-purple/20 flex items-center justify-center mr-4">
                <i class="fa fa-money text-monkey-purple text-2xl"></i>
              </div>
              <div>
                <h3 class="text-xl font-bold" id="adminTotalRevenue">$0</h3>
                <p class="text-gray-400 text-sm">总营收</p>
              </div>
            </div>
          </div>
        </div>
        
        <!-- 快速操作 -->
        <div class="mb-12">
          <h2 class="text-2xl font-bold mb-6">快速操作</h2>
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
            <a href="#adminCreateCodes" class="bg-monkey-orange/10 hover:bg-monkey-orange/20 border border-monkey-orange/30 rounded-xl p-6 flex flex-col items-center justify-center transition-all duration-300 transform hover:scale-105">
              <div class="w-14 h-14 rounded-full bg-monkey-orange/20 flex items-center justify-center mb-4">
                <i class="fa fa-plus text-monkey-orange text-2xl"></i>
              </div>
              <h3 class="font-medium text-center">生成激活码</h3>
            </a>
            
            <a href="#adminViewUsers" class="bg-monkey-blue/10 hover:bg-monkey-blue/20 border border-monkey-blue/30 rounded-xl p-6 flex flex-col items-center justify-center transition-all duration-300 transform hover:scale-105">
              <div class="w-14 h-14 rounded-full bg-monkey-blue/20 flex items-center justify-center mb-4">
                <i class="fa fa-user text-monkey-blue text-2xl"></i>
              </div>
              <h3 class="font-medium text-center">查看用户</h3>
            </a>
            
            <a href="#adminViewPockets" class="bg-monkey-green/10 hover:bg-monkey-green/20 border border-monkey-green/30 rounded-xl p-6 flex flex-col items-center justify-center transition-all duration-300 transform hover:scale-105">
              <div class="w-14 h-14 rounded-full bg-monkey-green/20 flex items-center justify-center mb-4">
                <i class="fa fa-briefcase text-monkey-green text-2xl"></i>
              </div>
              <h3 class="font-medium text-center">查看百宝袋</h3>
            </a>
            
            <a href="#adminViewCodes" class="bg-monkey-purple/10 hover:bg-monkey-purple/20 border border-monkey-purple/30 rounded-xl p-6 flex flex-col items-center justify-center transition-all duration-300 transform hover:scale-105">
              <div class="w-14 h-14 rounded-full bg-monkey-purple/20 flex items-center justify-center mb-4">
                <i class="fa fa-list text-monkey-purple text-2xl"></i>
              </div>
              <h3 class="font-medium text-center">激活码列表</h3>
            </a>
          </div>
        </div>
        
        <!-- 最近激活记录 -->
        <div>
          <h2 class="text-2xl font-bold mb-6">最近激活记录</h2>
          <div class="bg-monkey-gray/30 backdrop-blur-sm rounded-xl p-6 border border-monkey-gray/50">
            <div id="adminRecentActivity" class="space-y-4">
              <div class="text-center py-8 text-gray-500">
                <i class="fa fa-history text-3xl mb-3"></i>
                <p>暂无激活记录</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- 生成激活码页面 -->
    <section id="adminCreateCodes" class="py-20 bg-monkey-dark page-section page-transition">
      <div class="container mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center mb-16">
          <h2 class="text-[clamp(1.8rem,3vw,2.5rem)] font-bold mb-4">生成<span class="text-monkey-orange">激活码</span></h2>
          <p class="text-gray-400 max-w-2xl mx-auto">为新的Monkey Pocket设备生成激活码和密码</p>
        </div>
        
        <div class="max-w-2xl mx-auto">
          <div class="bg-monkey-gray/30 backdrop-blur-sm rounded-xl p-6 border border-monkey-gray/50">
            <h3 class="text-xl font-semibold mb-6">生成设置</h3>
            
            <div class="space-y-6">
              <div>
                <label for="codeCount" class="block text-sm font-medium text-gray-300 mb-2">生成数量</label>
                <input type="number" id="codeCount" class="w-full bg-monkey-gray/50 border border-monkey-gray rounded-lg px-4 py-3 text-white focus:outline-none focus:border-monkey-orange transition-colors" value="1" min="1" max="100">
                <p class="text-xs text-gray-500 mt-1">一次最多可生成100个激活码</p>
              </div>
              
              <div>
                <label for="passwordLength" class="block text-sm font-medium text-gray-300 mb-2">密码长度</label>
                <input type="number" id="passwordLength" class="w-full bg-monkey-gray/50 border border-monkey-gray rounded-lg px-4 py-3 text-white focus:outline-none focus:border-monkey-orange transition-colors" value="8" min="6" max="20">
                <p class="text-xs text-gray-500 mt-1">密码长度建议8-12位</p>
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-300 mb-2">密码复杂度</label>
                <div class="flex space-x-4">
                  <label class="flex items-center">
                    <input type="radio" name="complexity" value="simple" class="mr-2 text-monkey-orange focus:ring-monkey-orange" checked>
                    <span class="text-sm">简单 (仅数字)</span>
                  </label>
                  <label class="flex items-center">
                    <input type="radio" name="complexity" value="medium" class="mr-2 text-monkey-orange focus:ring-monkey-orange">
                    <span class="text-sm">中等 (字母+数字)</span>
                  </label>
                  <label class="flex items-center">
                    <input type="radio" name="complexity" value="strong" class="mr-2 text-monkey-orange focus:ring-monkey-orange">
                    <span class="text-sm">复杂 (大小写字母+数字+符号)</span>
                  </label>
                </div>
              </div>
              
              <div>
                <label for="expiryDate" class="block text-sm font-medium text-gray-300 mb-2">有效期限</label>
                <input type="date" id="expiryDate" class="w-full bg-monkey-gray/50 border border-monkey-gray rounded-lg px-4 py-3 text-white focus:outline-none focus:border-monkey-orange transition-colors">
                <p class="text-xs text-gray-500 mt-1">留空表示永久有效</p>
              </div>
              
              <button id="generateCodesBtn" class="w-full bg-monkey-orange hover:bg-monkey-orange/90 text-white font-semibold py-3 px-4 rounded-lg transition-all duration-300 transform hover:scale-[1.02] glow-orange">
                <i class="fa fa-key mr-2"></i> 生成激活码
              </button>
            </div>
          </div>
          
          <div id="generatedCodesContainer" class="mt-8 hidden">
            <div class="bg-monkey-gray/30 backdrop-blur-sm rounded-xl p-6 border border-monkey-gray/50">
              <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-semibold">生成的激活码</h3>
                <button id="copyAllCodes" class="bg-monkey-blue hover:bg-monkey-blue/90 text-white text-sm font-medium py-2 px-4 rounded-lg transition-colors">
                  <i class="fa fa-copy mr-1"></i> 复制全部
                </button>
              </div>
              
              <div class="bg-monkey-gray/50 rounded-lg p-4 max-h-96 overflow-y-auto">
                <table class="w-full text-sm">
                  <thead>
                    <tr class="border-b border-monkey-gray">
                      <th class="text-left py-2 px-3">序号</th>
                      <th class="text-left py-2 px-3">激活码</th>
                      <th class="text-left py-2 px-3">密码</th>
                      <th class="text-left py-2 px-3">状态</th>
                    </tr>
                  </thead>
                  <tbody id="generatedCodesList">
                    <!-- 生成的激活码将通过JavaScript动态添加 -->
                  </tbody>
                </table>
              </div>
              
              <div class="mt-6 p-4 bg-monkey-green/10 border border-monkey-green/30 rounded-lg">
                <div class="flex items-start">
                  <i class="fa fa-info-circle text-monkey-green text-xl mt-1 mr-3"></i>
                  <div>
                    <h4 class="font-medium text-monkey-green">重要提示</h4>
                    <p class="text-sm text-gray-300 mt-1">请将这些激活码和密码安全地分发给客户。每个激活码只能使用一次。</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- 查看用户页面 -->
    <section id="adminViewUsers" class="py-20 page-section page-transition">
      <div class="container mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center mb-16">
          <h2 class="text-[clamp(1.8rem,3vw,2.5rem)] font-bold mb-4">查看<span class="text-monkey-blue">用户</span></h2>
          <p class="text-gray-400 max-w-2xl mx-auto">管理所有注册Monkey Pocket的用户</p>
        </div>
        
        <div class="bg-monkey-gray/30 backdrop-blur-sm rounded-xl p-6 border border-monkey-gray/50">
          <div class="flex justify-between items-center mb-6">
            <h3 class="text-xl font-semibold">用户列表</h3>
            <div class="flex items-center space-x-4">
              <div class="relative">
                <input type="text" id="searchUsers" class="bg-monkey-gray/50 border border-monkey-gray rounded-lg pl-10 pr-4 py-2 text-white focus:outline-none focus:border-monkey-blue transition-colors" placeholder="搜索用户...">
                <i class="fa fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
              </div>
            </div>
          </div>
          
          <div class="overflow-x-auto">
            <table class="w-full">
              <thead>
                <tr class="border-b border-monkey-gray">
                  <th class="text-left py-3 px-4">用户名</th>
                  <th class="text-left py-3 px-4">邮箱</th>
                  <th class="text-left py-3 px-4">注册日期</th>
                  <th class="text-left py-3 px-4">最后登录</th>
                  <th class="text-left py-3 px-4">百宝袋数量</th>
                  <th class="text-left py-3 px-4">操作</th>
                </tr>
              </thead>
              <tbody id="usersList">
                <!-- 用户数据将通过JavaScript动态添加 -->
              </tbody>
            </table>
          </div>
          
          <div id="noUsersMessage" class="text-center py-12 text-gray-500">
            <i class="fa fa-users text-4xl mb-3"></i>
            <p>暂无用户数据</p>
          </div>
        </div>
      </div>
    </section>

    <!-- 查看百宝袋页面 -->
    <section id="adminViewPockets" class="py-20 bg-monkey-dark page-section page-transition">
      <div class="container mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center mb-16">
          <h2 class="text-[clamp(1.8rem,3vw,2.5rem)] font-bold mb-4">查看<span class="text-monkey-green">百宝袋</span></h2>
          <p class="text-gray-400 max-w-2xl mx-auto">查看所有已激活的Monkey Pocket设备</p>
        </div>
        
        <div class="bg-monkey-gray/30 backdrop-blur-sm rounded-xl p-6 border border-monkey-gray/50">
          <div class="flex justify-between items-center mb-6">
            <h3 class="text-xl font-semibold">百宝袋列表</h3>
            <div class="flex items-center space-x-4">
              <div class="relative">
                <input type="text" id="searchPockets" class="bg-monkey-gray/50 border border-monkey-gray rounded-lg pl-10 pr-4 py-2 text-white focus:outline-none focus:border-monkey-green transition-colors" placeholder="搜索百宝袋...">
                <i class="fa fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
              </div>
            </div>
          </div>
          
          <div class="overflow-x-auto">
            <table class="w-full">
              <thead>
                <tr class="border-b border-monkey-gray">
                  <th class="text-left py-3 px-4">激活码</th>
                  <th class="text-left py-3 px-4">名称</th>
                  <th class="text-left py-3 px-4">所属用户</th>
                  <th class="text-left py-3 px-4">IP地址</th>
                  <th class="text-left py-3 px-4">存储格</th>
                  <th class="text-left py-3 px-4">物品数量</th>
                  <th class="text-left py-3 px-4">激活日期</th>
                  <th class="text-left py-3 px-4">操作</th>
                </tr>
              </thead>
              <tbody id="pocketsListAdmin">
                <!-- 百宝袋数据将通过JavaScript动态添加 -->
              </tbody>
            </table>
          </div>
          
          <div id="noPocketsAdminMessage" class="text-center py-12 text-gray-500">
            <i class="fa fa-briefcase text-4xl mb-3"></i>
            <p>暂无百宝袋数据</p>
          </div>
        </div>
      </div>
    </section>

    <!-- 查看激活码页面 -->
    <section id="adminViewCodes" class="py-20 page-section page-transition">
      <div class="container mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center mb-16">
          <h2 class="text-[clamp(1.8rem,3vw,2.5rem)] font-bold mb-4">查看<span class="text-monkey-purple">激活码</span></h2>
          <p class="text-gray-400 max-w-2xl mx-auto">查看所有已生成和已使用的激活码</p>
        </div>
        
        <div class="bg-monkey-gray/30 backdrop-blur-sm rounded-xl p-6 border border-monkey-gray/50">
          <div class="flex justify-between items-center mb-6">
            <h3 class="text-xl font-semibold">激活码列表</h3>
            <div class="flex items-center space-x-4">
              <select id="filterCodeStatus" class="bg-monkey-gray/50 border border-monkey-gray rounded-lg px-4 py-2 text-white focus:outline-none focus:border-monkey-purple transition-colors">
                <option value="all">全部状态</option>
                <option value="unused">未使用</option>
                <option value="used">已使用</option>
                <option value="expired">已过期</option>
              </select>
              <div class="relative">
                <input type="text" id="searchCodes" class="bg-monkey-gray/50 border border-monkey-gray rounded-lg pl-10 pr-4 py-2 text-white focus:outline-none focus:border-monkey-purple transition-colors" placeholder="搜索激活码...">
                <i class="fa fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
              </div>
            </div>
          </div>
          
          <div class="overflow-x-auto">
            <table class="w-full">
              <thead>
                <tr class="border-b border-monkey-gray">
                  <th class="text-left py-3 px-4">激活码</th>
                  <th class="text-left py-3 px-4">密码</th>
                  <th class="text-left py-3 px-4">状态</th>
                  <th class="text-left py-3 px-4">使用者</th>
                  <th class="text-left py-3 px-4">生成日期</th>
                  <th class="text-left py-3 px-4">有效期限</th>
                  <th class="text-left py-3 px-4">操作</th>
                </tr>
              </thead>
              <tbody id="codesList">
                <!-- 激活码数据将通过JavaScript动态添加 -->
              </tbody>
            </table>
          </div>
          
          <div id="noCodesMessage" class="text-center py-12 text-gray-500">
            <i class="fa fa-key text-4xl mb-3"></i>
            <p>暂无激活码数据</p>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- 页脚 -->
  <footer class="bg-monkey-darker border-t border-monkey-gray/30 py-12">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8">
      <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
        <div>
          <div class="flex items-center space-x-2 mb-6">
            <div class="w-10 h-10 rounded-full bg-monkey-yellow flex items-center justify-center">
              <span class="text-monkey-darker font-bold text-xl">MK</span>
            </div>
            <span class="text-2xl font-bold text-shadow">Monkey <span class="text-monkey-yellow">Pocket</span></span>
          </div>
          <p class="text-gray-400 mb-6" data-i18n="footerDescription">
            魔法百宝袋，改变您携带和管理物品的方式。
          </p>
          <div class="flex space-x-4">
            <a href="#" class="text-gray-400 hover:text-monkey-yellow transition-colors">
              <i class="fa fa-facebook"></i>
            </a>
            <a href="#" class="text-gray-400 hover:text-monkey-yellow transition-colors">
              <i class="fa fa-twitter"></i>
            </a>
            <a href="#" class="text-gray-400 hover:text-monkey-yellow transition-colors">
              <i class="fa fa-instagram"></i>
            </a>
            <a href="#" class="text-gray-400 hover:text-monkey-yellow transition-colors">
              <i class="fa fa-youtube-play"></i>
            </a>
          </div>
        </div>
        
        <div>
          <h3 class="text-lg font-semibold mb-6" data-i18n="footerProducts">产品</h3>
          <ul class="space-y-3">
            <li><a href="#" class="text-gray-400 hover:text-monkey-yellow transition-colors" data-i18n="footerProduct1">Monkey Pocket Pro</a></li>
            <li><a href="#" class="text-gray-400 hover:text-monkey-yellow transition-colors" data-i18n="footerProduct2">Monkey Pocket Mini</a></li>
            <li><a href="#" class="text-gray-400 hover:text-monkey-yellow transition-colors" data-i18n="footerProduct3">配件</a></li>
            <li><a href="#" class="text-gray-400 hover:text-monkey-yellow transition-colors" data-i18n="footerProduct4">替换零件</a></li>
            <li><a href="#" class="text-gray-400 hover:text-monkey-yellow transition-colors" data-i18n="footerProduct5">礼品卡</a></li>
          </ul>
        </div>
        
        <div>
          <h3 class="text-lg font-semibold mb-6" data-i18n="footerSupport">支持</h3>
          <ul class="space-y-3">
            <li><a href="#" class="text-gray-400 hover:text-monkey-yellow transition-colors" data-i18n="footerSupport1">帮助中心</a></li>
            <li><a href="#" class="text-gray-400 hover:text-monkey-yellow transition-colors" data-i18n="footerSupport2">联系我们</a></li>
            <li><a href="#" class="text-gray-400 hover:text-monkey-yellow transition-colors" data-i18n="footerSupport3">保修</a></li>
            <li><a href="#" class="text-gray-400 hover:text-monkey-yellow transition-colors" data-i18n="footerSupport4">常见问题</a></li>
            <li><a href="#" class="text-gray-400 hover:text-monkey-yellow transition-colors" data-i18n="footerSupport5">故障排除</a></li>
          </ul>
        </div>
        
        <div>
          <h3 class="text-lg font-semibold mb-6" data-i18n="footerCompany">公司</h3>
          <ul class="space-y-3">
            <li><a href="#" class="text-gray-400 hover:text-monkey-yellow transition-colors" data-i18n="footerCompany1">关于我们</a></li>
            <li><a href="#" class="text-gray-400 hover:text-monkey-yellow transition-colors" data-i18n="footerCompany2">招聘</a></li>
            <li><a href="#" class="text-gray-400 hover:text-monkey-yellow transition-colors" data-i18n="footerCompany3">新闻</a></li>
            <li><a href="#" class="text-gray-400 hover:text-monkey-yellow transition-colors" data-i18n="footerCompany4">隐私政策</a></li>
            <li><a href="#" class="text-gray-400 hover:text-monkey-yellow transition-colors" data-i18n="footerCompany5">服务条款</a></li>
          </ul>
        </div>
      </div>
      
      <div class="border-t border-monkey-gray/30 mt-12 pt-8 flex flex-col md:flex-row justify-between items-center">
        <p class="text-gray-500 text-sm mb-4 md:mb-0">
          &copy; 2025 Monkey Kingdom. <span data-i18n="footerRights">版权所有。</span>
        </p>
        <div class="flex space-x-6">
          <a href="#" class="text-gray-500 hover:text-gray-300 text-sm transition-colors" data-i18n="footerPrivacy">隐私政策</a>
          <a href="#" class="text-gray-500 hover:text-gray-300 text-sm transition-colors" data-i18n="footerTerms">服务条款</a>
          <a href="#" class="text-gray-500 hover:text-gray-300 text-sm transition-colors" data-i18n="footerCookies">Cookie政策</a>
        </div>
      </div>
    </div>
  </footer>

  <!-- JavaScript -->
  <script>
    // ============================
    // 应用程序状态管理
    // ============================
    const AppState = {
      // 当前用户信息
      currentUser: null,
      currentAdmin: null,
      
      // 所有用户数据 (模拟数据库)
      users: {},
      
      // 所有激活码数据
      activationCodes: {},
      
      // 当前语言
      currentLang: 'zh',
      
      // 当前选中的百宝袋
      selectedPocketId: null,
      
      // 选中的远程取物物品
      selectedItemsForRetrieval: [],
      
      // 活动页面
      activePage: 'dashboard',
      
      // 邮箱验证码相关
      emailVerificationCodes: {},
      
      // 管理员设置
      adminUsername: 'MonkeyKingdomCEO',
      adminPassword: 'zzx070502ZZX070502',
      
      // 初始化应用程序
      init() {
        this.loadUsersFromStorage();
        this.loadActivationCodesFromStorage();
        this.checkAutoLogin();
        this.checkAdminAutoLogin();
        this.setupEventListeners();
        this.initLanguage();
        this.showAuthPage();
        
        // 如果本地存储中没有激活码，创建一些演示激活码
        if (Object.keys(this.activationCodes).length === 0) {
          this.createDemoActivationCodes();
        }
      },
      
      // 从本地存储加载用户数据
      loadUsersFromStorage() {
        const storedUsers = localStorage.getItem('monkeyPocketUsers');
        if (storedUsers) {
          this.users = JSON.parse(storedUsers);
        }
        
        // 初始化演示数据
        if (Object.keys(this.users).length === 0) {
          this.createDemoData();
        }
      },
      
      // 从本地存储加载激活码数据
      loadActivationCodesFromStorage() {
        const storedCodes = localStorage.getItem('monkeyPocketActivationCodes');
        if (storedCodes) {
          this.activationCodes = JSON.parse(storedCodes);
        }
      },
      
      // 保存激活码数据到本地存储
      saveActivationCodesToStorage() {
        localStorage.setItem('monkeyPocketActivationCodes', JSON.stringify(this.activationCodes));
      },
      
      // 创建演示数据
      createDemoData() {
        // 创建演示用户
        const demoUser = {
          id: 'user_001',
          username: '猴子爱好者',
          email: 'demo@monkeypocket.com',
          password: 'monkey123', // 实际应用中应加密存储
          createdAt: new Date().toISOString(),
          lastLogin: null,
          rememberMe: false
        };
        
        // 保存用户
        this.users[demoUser.email] = demoUser;
        
        // 保存用户数据到本地存储
        const userData = {
          pockets: [],
          recentActivity: []
        };
        
        localStorage.setItem(`user_${demoUser.id}_data`, JSON.stringify(userData));
        localStorage.setItem('monkeyPocketUsers', JSON.stringify(this.users));
      },
      
      // 创建演示激活码
      createDemoActivationCodes() {
        // 创建一些演示激活码
        const demoCodes = {
          'MK-7890-ABCD-1234': {
            password: 'demo1234',
            used: false,
            userId: null,
            pocketId: null,
            generatedAt: new Date().toISOString(),
            expiresAt: null
          },
          'MK-5678-EFGH-9012': {
            password: 'test5678',
            used: false,
            userId: null,
            pocketId: null,
            generatedAt: new Date().toISOString(),
            expiresAt: null
          },
          'MK-3456-IJKL-7890': {
            password: 'code3456',
            used: true,
            userId: 'user_001',
            pocketId: 'pocket_001',
            generatedAt: new Date(Date.now() - 30 * 24 * 60 * 60 * 1000).toISOString(), // 30天前
            expiresAt: null
          }
        };
        
        this.activationCodes = demoCodes;
        this.saveActivationCodesToStorage();
      },
      
      // 生成新的激活码
      generateActivationCode() {
        // 格式: MK-XXXX-XXXX-XXXX
        const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
        let code = 'MK-';
        
        for (let i = 0; i < 12; i++) {
          if (i > 0 && i % 4 === 0) {
            code += '-';
          }
          code += chars.charAt(Math.floor(Math.random() * chars.length));
        }
        
        return code;
      },
      
      // 生成密码
      generatePassword(length = 8, complexity = 'medium') {
        let chars = '';
        let password = '';
        
        if (complexity === 'simple') {
          chars = '0123456789';
        } else if (complexity === 'medium') {
          chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
        } else if (complexity === 'strong') {
          chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*()_+-=[]{}|;:,.<>?';
        }
        
        for (let i = 0; i < length; i++) {
          password += chars.charAt(Math.floor(Math.random() * chars.length));
        }
        
        return password;
      },
      
      // 生成6位邮箱验证码
      generateVerificationCode() {
        return Math.floor(100000 + Math.random() * 900000).toString();
      },
      
      // 检查自动登录
      checkAutoLogin() {
        const savedLogin = localStorage.getItem('monkeyPocketCurrentUser');
        if (savedLogin) {
          const { userId, expiry } = JSON.parse(savedLogin);
          
          // 检查是否过期 (30天)
          if (new Date().getTime() < expiry) {
            const userData = this.getUserData(userId);
            if (userData) {
              this.currentUser = userData.user;
              this.showMainContent();
              this.updateDashboard();
              this.showPage('dashboard');
            }
          } else {
            // 清除过期的登录信息
            localStorage.removeItem('monkeyPocketCurrentUser');
          }
        }
      },
      
      // 检查管理员自动登录
      checkAdminAutoLogin() {
        const savedAdminLogin = sessionStorage.getItem('monkeyPocketAdmin');
        if (savedAdminLogin) {
          const { adminUsername, expiry } = JSON.parse(savedAdminLogin);
          
          // 检查是否过期 (会话期间)
          if (new Date().getTime() < expiry) {
            this.currentAdmin = { username: adminUsername };
            this.showAdminContent();
            this.updateAdminDashboard();
            this.showAdminPage('adminDashboard');
          } else {
            // 清除过期的登录信息
            sessionStorage.removeItem('monkeyPocketAdmin');
          }
        }
      },
      
      // 获取用户数据
      getUserData(userId) {
        const userDataStr = localStorage.getItem(`user_${userId}_data`);
        if (!userDataStr) return null;
        
        const userData = JSON.parse(userDataStr);
        
        // 从用户列表中找到用户信息
        const user = Object.values(this.users).find(u => u.id === userId);
        
        return {
          user,
          pockets: userData.pockets || [],
          recentActivity: userData.recentActivity || []
        };
      },
      
      // 保存用户数据
      saveUserData(userId, data) {
        localStorage.setItem(`user_${userId}_data`, JSON.stringify(data));
      },
      
      // 保存当前用户
      saveCurrentUser(user, rememberMe = false) {
        this.currentUser = user;
        
        if (rememberMe) {
          // 设置30天过期
          const expiry = new Date().getTime() + (30 * 24 * 60 * 60 * 1000);
          localStorage.setItem('monkeyPocketCurrentUser', JSON.stringify({
            userId: user.id,
            expiry
          }));
        } else {
          // 会话存储
          sessionStorage.setItem('monkeyPocketCurrentUser', JSON.stringify({
            userId: user.id
          }));
        }
        
        // 更新最后登录时间
        user.lastLogin = new Date().toISOString();
        this.users[user.email] = user;
        localStorage.setItem('monkeyPocketUsers', JSON.stringify(this.users));
        
        this.showMainContent();
        this.updateDashboard();
        this.showPage('dashboard');
      },
      
      // 保存当前管理员
      saveCurrentAdmin(admin) {
        this.currentAdmin = admin;
        
        // 设置会话过期时间 (12小时)
        const expiry = new Date().getTime() + (12 * 60 * 60 * 1000);
        sessionStorage.setItem('monkeyPocketAdmin', JSON.stringify({
          adminUsername: admin.username,
          expiry
        }));
        
        this.showAdminContent();
        this.updateAdminDashboard();
        this.showAdminPage('adminDashboard');
      },
      
      // 退出登录
      logout() {
        this.currentUser = null;
        localStorage.removeItem('monkeyPocketCurrentUser');
        sessionStorage.removeItem('monkeyPocketCurrentUser');
        this.showAuthPage();
      },
      
      // 退出管理员
      adminLogout() {
        this.currentAdmin = null;
        sessionStorage.removeItem('monkeyPocketAdmin');
        this.showAuthPage();
      },
      
      // 显示登录页面
      showAuthPage() {
        document.getElementById('authPage').classList.remove('hidden');
        document.getElementById('mainContent').classList.add('hidden');
        document.getElementById('adminContent').classList.add('hidden');
        document.getElementById('userMenu').classList.add('hidden');
        document.getElementById('adminMenu').classList.add('hidden');
        document.getElementById('mobileUserMenu').classList.add('hidden');
        document.getElementById('mobileAdminMenu').classList.add('hidden');
        document.getElementById('adminNavLink').classList.remove('hidden');
        document.getElementById('mobileAdminNavLink').classList.remove('hidden');
        this.showLoginForm();
      },
      
      // 显示主内容
      showMainContent() {
        document.getElementById('authPage').classList.add('hidden');
        document.getElementById('mainContent').classList.remove('hidden');
        document.getElementById('adminContent').classList.add('hidden');
        document.getElementById('userMenu').classList.remove('hidden');
        document.getElementById('adminMenu').classList.add('hidden');
        document.getElementById('mobileUserMenu').classList.remove('hidden');
        document.getElementById('mobileAdminMenu').classList.add('hidden');
        document.getElementById('adminNavLink').classList.add('hidden');
        document.getElementById('mobileAdminNavLink').classList.add('hidden');
        
        // 更新用户信息显示
        if (this.currentUser) {
          const username = this.currentUser.username;
          document.getElementById('usernameDisplay').textContent = username;
          document.getElementById('dropdownUsername').textContent = username;
          document.getElementById('dropdownEmail').textContent = this.currentUser.email;
          document.getElementById('dashboardUsername').textContent = username;
          document.getElementById('userInitial').textContent = username.charAt(0).toUpperCase();
        }
      },
      
      // 显示管理员内容
      showAdminContent() {
        document.getElementById('authPage').classList.add('hidden');
        document.getElementById('mainContent').classList.add('hidden');
        document.getElementById('adminContent').classList.remove('hidden');
        document.getElementById('userMenu').classList.add('hidden');
        document.getElementById('adminMenu').classList.remove('hidden');
        document.getElementById('mobileUserMenu').classList.add('hidden');
        document.getElementById('mobileAdminMenu').classList.remove('hidden');
        document.getElementById('adminNavLink').classList.add('hidden');
        document.getElementById('mobileAdminNavLink').classList.add('hidden');
      },
      
      // 显示登录表单
      showLoginForm() {
        document.getElementById('loginForm').classList.remove('hidden');
        document.getElementById('registerForm').classList.add('hidden');
        document.getElementById('adminLoginForm').classList.add('hidden');
        document.getElementById('showLogin').classList.add('bg-monkey-blue', 'text-white');
        document.getElementById('showLogin').classList.remove('text-gray-300');
        document.getElementById('showRegister').classList.remove('bg-monkey-blue', 'text-white');
        document.getElementById('showRegister').classList.add('text-gray-300');
      },
      
      // 显示注册表单
      showRegisterForm() {
        document.getElementById('registerForm').classList.remove('hidden');
        document.getElementById('loginForm').classList.add('hidden');
        document.getElementById('adminLoginForm').classList.add('hidden');
        document.getElementById('showRegister').classList.add('bg-monkey-blue', 'text-white');
        document.getElementById('showRegister').classList.remove('text-gray-300');
        document.getElementById('showLogin').classList.remove('bg-monkey-blue', 'text-white');
        document.getElementById('showLogin').classList.add('text-gray-300');
      },
      
      // 显示管理员登录表单
      showAdminLoginForm() {
        document.getElementById('adminLoginForm').classList.remove('hidden');
        document.getElementById('loginForm').classList.add('hidden');
        document.getElementById('registerForm').classList.add('hidden');
        document.getElementById('showLogin').classList.remove('bg-monkey-blue', 'text-white');
        document.getElementById('showLogin').classList.add('text-gray-300');
        document.getElementById('showRegister').classList.remove('bg-monkey-blue', 'text-white');
        document.getElementById('showRegister').classList.add('text-gray-300');
      },
      
      // 显示页面
      showPage(pageId) {
        // 隐藏所有页面
        document.querySelectorAll('.page-section').forEach(section => {
          section.classList.remove('active');
          setTimeout(() => {
            section.classList.add('hidden');
          }, 50);
        });
        
        // 显示目标页面
        setTimeout(() => {
          const targetPage = document.getElementById(pageId);
          if (targetPage) {
            targetPage.classList.remove('hidden');
            setTimeout(() => {
              targetPage.classList.add('active');
            }, 50);
          }
        }, 100);
        
        // 更新活动页面
        this.activePage = pageId;
        
        // 更新页面内容
        if (pageId === 'dashboard') {
          this.updateDashboard();
        } else if (pageId === 'myPockets') {
          this.renderPocketsList();
        } else if (pageId === 'items') {
          this.updatePocketSelectors();
          this.renderItemsList();
        } else if (pageId === 'retrieve') {
          this.updateRetrievePocketSelector();
          this.renderAvailableItemsList();
        }
      },
      
      // 显示管理员页面
      showAdminPage(pageId) {
        // 隐藏所有页面
        document.querySelectorAll('.page-section').forEach(section => {
          section.classList.remove('active');
          setTimeout(() => {
            section.classList.add('hidden');
          }, 50);
        });
        
        // 显示目标页面
        setTimeout(() => {
          const targetPage = document.getElementById(pageId);
          if (targetPage) {
            targetPage.classList.remove('hidden');
            setTimeout(() => {
              targetPage.classList.add('active');
            }, 50);
          }
        }, 100);
        
        // 更新活动页面
        this.activePage = pageId;
        
        // 更新页面内容
        if (pageId === 'adminDashboard') {
          this.updateAdminDashboard();
        } else if (pageId === 'adminViewUsers') {
          this.renderAdminUsersList();
        } else if (pageId === 'adminViewPockets') {
          this.renderAdminPocketsList();
        } else if (pageId === 'adminViewCodes') {
          this.renderAdminCodesList();
        }
      },
      
      // 更新仪表板
      updateDashboard() {
        if (!this.currentUser) return;
        
        const userData = this.getUserData(this.currentUser.id);
        if (!userData) return;
        
        // 计算统计数据
        const totalPockets = userData.pockets.length;
        const totalItems = userData.pockets.reduce((sum, pocket) => sum + pocket.items.length, 0);
        const totalStorageSlots = userData.pockets.reduce((sum, pocket) => sum + pocket.storageSlots, 0);
        
        // 更新统计卡片
        document.getElementById('totalPocketsCount').textContent = totalPockets;
        document.getElementById('totalItemsCount').textContent = totalItems;
        document.getElementById('totalStorageSlots').textContent = totalStorageSlots;
        
        // 更新最近活动
        this.renderRecentActivity(userData.recentActivity);
      },
      
      // 更新管理员仪表板
      updateAdminDashboard() {
        // 计算统计数据
        const totalCodes = Object.keys(this.activationCodes).length;
        const totalUsers = Object.keys(this.users).length;
        
        // 计算已激活的百宝袋数量
        let activePockets = 0;
        let totalRevenue = 0;
        
        // 遍历所有用户数据
        Object.values(this.users).forEach(user => {
          const userData = this.getUserData(user.id);
          if (userData) {
            activePockets += userData.pockets.length;
            
            // 计算每个百宝袋的购买记录
            userData.pockets.forEach(pocket => {
              if (pocket.purchaseHistory) {
                pocket.purchaseHistory.forEach(purchase => {
                  totalRevenue += purchase.price;
                });
              }
            });
          }
        });
        
        // 更新统计卡片
        document.getElementById('adminTotalCodes').textContent = totalCodes;
        document.getElementById('adminTotalUsers').textContent = totalUsers;
        document.getElementById('adminActivePockets').textContent = activePockets;
        document.getElementById('adminTotalRevenue').textContent = `$${totalRevenue}`;
        
        // 更新最近激活记录
        this.renderAdminRecentActivity();
      },
      
      // 渲染最近活动
      renderRecentActivity(activities) {
        const activityList = document.getElementById('recentActivityList');
        
        if (!activities || activities.length === 0) {
          activityList.innerHTML = `
            <div class="text-center py-8 text-gray-500">
              <i class="fa fa-history text-3xl mb-3"></i>
              <p data-i18n="dashboardNoActivity">暂无活动记录</p>
            </div>
          `;
          return;
        }
        
        // 只显示最近5条活动
        const recentActivities = activities.slice(-5).reverse();
        
        activityList.innerHTML = '';
        
        recentActivities.forEach(activity => {
          const activityElement = document.createElement('div');
          activityElement.className = 'flex items-start py-3 border-b border-monkey-gray/50 last:border-0';
          
          let icon = 'fa-info-circle';
          let iconColor = 'text-monkey-blue';
          
          if (activity.type === 'add_pocket') {
            icon = 'fa-plus-circle';
            iconColor = 'text-monkey-green';
          } else if (activity.type === 'add_item') {
            icon = 'fa-box-open';
            iconColor = 'text-monkey-yellow';
          } else if (activity.type === 'retrieve') {
            icon = 'fa-download';
            iconColor = 'text-monkey-purple';
          } else if (activity.type === 'purchase') {
            icon = 'fa-shopping-cart';
            iconColor = 'text-monkey-blue';
          }
          
          activityElement.innerHTML = `
            <div class="w-8 h-8 rounded-full bg-monkey-gray/50 flex items-center justify-center mr-3">
              <i class="fa ${icon} ${iconColor}"></i>
            </div>
            <div class="flex-1">
              <p class="text-sm">${activity.description}</p>
              <p class="text-xs text-gray-500 mt-1">${new Date(activity.timestamp).toLocaleString()}</p>
            </div>
          `;
          
          activityList.appendChild(activityElement);
        });
      },
      
      // 渲染管理员最近激活记录
      renderAdminRecentActivity() {
        const activityList = document.getElementById('adminRecentActivity');
        
        // 获取所有激活记录
        let recentActivations = [];
        
        // 遍历所有激活码，找出最近使用的
        Object.entries(this.activationCodes).forEach(([code, data]) => {
          if (data.used && data.userId) {
            // 获取用户信息
            const user = Object.values(this.users).find(u => u.id === data.userId);
            if (user) {
              recentActivations.push({
                code,
                username: user.username,
                timestamp: data.generatedAt,
                status: '已激活'
              });
            }
          }
        });
        
        // 按时间排序，获取最近5条
        recentActivations.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
        recentActivations = recentActivations.slice(0, 5);
        
        if (recentActivations.length === 0) {
          activityList.innerHTML = `
            <div class="text-center py-8 text-gray-500">
              <i class="fa fa-history text-3xl mb-3"></i>
              <p>暂无激活记录</p>
            </div>
          `;
          return;
        }
        
        activityList.innerHTML = '';
        
        recentActivations.forEach(activation => {
          const activityElement = document.createElement('div');
          activityElement.className = 'flex items-start py-3 border-b border-monkey-gray/50 last:border-0';
          
          activityElement.innerHTML = `
            <div class="w-8 h-8 rounded-full bg-monkey-orange/20 flex items-center justify-center mr-3">
              <i class="fa fa-key text-monkey-orange"></i>
            </div>
            <div class="flex-1">
              <p class="text-sm"><span class="font-medium">${activation.code}</span> 被用户 <span class="font-medium">${activation.username}</span> 激活</p>
              <p class="text-xs text-gray-500 mt-1">${new Date(activation.timestamp).toLocaleString()}</p>
            </div>
            <span class="text-xs px-2 py-1 rounded-full bg-green-500/20 text-green-400">${activation.status}</span>
          `;
          
          activityList.appendChild(activityElement);
        });
      },
      
      // 添加活动记录
      addActivity(userId, type, description) {
        const userData = this.getUserData(userId);
        if (!userData) return;
        
        const activity = {
          id: 'activity_' + Date.now(),
          type,
          description,
          timestamp: new Date().toISOString()
        };
        
        userData.recentActivity.push(activity);
        this.saveUserData(userId, userData);
        
        // 如果当前用户是活动用户，更新仪表板
        if (this.currentUser && this.currentUser.id === userId) {
          this.updateDashboard();
        }
      },
      
      // 渲染百宝袋列表
      renderPocketsList() {
        if (!this.currentUser) return;
        
        const userData = this.getUserData(this.currentUser.id);
        if (!userData) return;
        
        const pocketsList = document.getElementById('pocketsList');
        const pocketsListContainer = document.getElementById('pocketsListContainer');
        const noPocketsMessage = document.getElementById('noPocketsMessage');
        
        if (userData.pockets.length === 0) {
          pocketsList.classList.add('hidden');
          noPocketsMessage.classList.remove('hidden');
          return;
        }
        
        noPocketsMessage.classList.add('hidden');
        pocketsList.classList.remove('hidden');
        pocketsList.innerHTML = '';
        
        userData.pockets.forEach(pocket => {
          const pocketElement = document.createElement('div');
          pocketElement.className = 'bg-monkey-gray/30 backdrop-blur-sm rounded-xl p-6 border border-monkey-gray/50 hover:border-monkey-blue/50 transition-all duration-300';
          pocketElement.dataset.id = pocket.id;
          
          // 计算存储格使用百分比
          const usagePercent = pocket.storageSlots > 0 ? Math.round((pocket.usedSlots / pocket.storageSlots) * 100) : 0;
          
          pocketElement.innerHTML = `
            <div class="flex justify-between items-start mb-4">
              <div>
                <h3 class="font-bold text-lg">${pocket.name}</h3>
                <p class="text-sm text-gray-400">${pocket.activationCode}</p>
              </div>
              <button class="delete-pocket-btn text-gray-400 hover:text-monkey-red transition-colors" data-id="${pocket.id}">
                <i class="fa fa-trash"></i>
              </button>
            </div>
            
            <div class="space-y-4">
              <div>
                <div class="flex justify-between text-sm mb-1">
                  <span class="text-gray-300" data-i18n="pocketStorage">存储格</span>
                  <span class="text-gray-300">${pocket.usedSlots}/${pocket.storageSlots}</span>
                </div>
                <div class="w-full bg-monkey-gray rounded-full h-2">
                  <div class="bg-monkey-blue h-2 rounded-full" style="width: ${usagePercent}%"></div>
                </div>
              </div>
              
              <div class="grid grid-cols-2 gap-4 text-sm">
                <div>
                  <p class="text-gray-400" data-i18n="pocketIP">IP地址</p>
                  <p class="font-medium">${pocket.ipAddress || '未绑定'}</p>
                </div>
                <div>
                  <p class="text-gray-400" data-i18n="pocketItems">物品数量</p>
                  <p class="font-medium">${pocket.items.length}</p>
                </div>
              </div>
              
              <div class="pt-2">
                <button class="w-full bg-monkey-gray/50 hover:bg-monkey-gray/70 text-white font-medium py-2 px-4 rounded-lg transition-colors select-pocket-btn" data-id="${pocket.id}">
                  <span data-i18n="pocketSelect">选择此百宝袋</span>
                </button>
              </div>
            </div>
          `;
          
          pocketsList.appendChild(pocketElement);
        });
        
        // 添加删除百宝袋事件监听
        document.querySelectorAll('.delete-pocket-btn').forEach(btn => {
          btn.addEventListener('click', (e) => {
            e.stopPropagation();
            const pocketId = btn.getAttribute('data-id');
            this.deletePocket(pocketId);
          });
        });
        
        // 添加选择百宝袋事件监听
        document.querySelectorAll('.select-pocket-btn').forEach(btn => {
          btn.addEventListener('click', (e) => {
            const pocketId = btn.getAttribute('data-id');
            this.selectPocket(pocketId);
          });
        });
      },
      
      // 删除百宝袋
      deletePocket(pocketId) {
        if (!this.currentUser) return;
        
        const userData = this.getUserData(this.currentUser.id);
        if (!userData) return;
        
        // 确认删除
        const confirmMsg = this.currentLang === 'en' 
          ? 'Are you sure you want to delete this Monkey Pocket? All items in it will be lost.'
          : '确定要删除这个百宝袋吗？里面的所有物品都将丢失。';
        
        if (!confirm(confirmMsg)) return;
        
        // 查找要删除的百宝袋
        const pocketToDelete = userData.pockets.find(p => p.id === pocketId);
        if (!pocketToDelete) return;
        
        // 从列表中移除
        userData.pockets = userData.pockets.filter(p => p.id !== pocketId);
        this.saveUserData(this.currentUser.id, userData);
        
        // 如果删除的是当前选中的百宝袋，清空选择
        if (this.selectedPocketId === pocketId) {
          this.selectedPocketId = null;
        }
        
        // 重新渲染列表
        this.renderPocketsList();
        
        // 更新其他相关UI
        this.updatePocketSelectors();
        this.renderItemsList();
        this.updateRetrievePocketSelector();
        this.updateDashboard();
        
        // 添加活动记录
        this.addActivity(this.currentUser.id, 'delete_pocket', 
          this.currentLang === 'en' 
            ? 'Deleted a Monkey Pocket' 
            : '删除了一个百宝袋'
        );
        
        // 显示成功消息
        this.showToast(
          this.currentLang === 'en' 
            ? 'Monkey Pocket deleted successfully!' 
            : '百宝袋删除成功！',
          'success'
        );
      },
      
      // 选择百宝袋
      selectPocket(pocketId) {
        this.selectedPocketId = pocketId;
        
        // 更新物品管理页面
        if (this.activePage === 'items') {
          this.renderItemsList();
        }
        
        // 更新远程取物页面
        if (this.activePage === 'retrieve') {
          this.renderAvailableItemsList();
        }
        
        // 显示成功消息
        this.showToast(
          this.currentLang === 'en' 
            ? 'Monkey Pocket selected!' 
            : '已选择百宝袋！',
          'success'
        );
      },
      
      // 更新所有百宝袋选择器
      updatePocketSelectors() {
        if (!this.currentUser) return;
        
        const userData = this.getUserData(this.currentUser.id);
        if (!userData) return;
        
        // 获取所有选择器
        const selectors = [
          document.getElementById('pocketSelector'),
          document.getElementById('targetPocket'),
          document.getElementById('purchasePocketSelector'),
          document.getElementById('retrievePocketSelector')
        ];
        
        selectors.forEach(selector => {
          if (!selector) return;
          
          // 保存当前选择的值
          const currentValue = selector.value;
          
          // 清空选项（除了第一个选项）
          while (selector.options.length > 1) {
            selector.remove(1);
          }
          
          // 添加百宝袋选项
          userData.pockets.forEach(pocket => {
            const option = document.createElement('option');
            option.value = pocket.id;
            option.textContent = `${pocket.name} (${pocket.activationCode})`;
            selector.appendChild(option);
          });
          
          // 恢复之前的选择（如果还存在）
          if (currentValue && Array.from(selector.options).some(opt => opt.value === currentValue)) {
            selector.value = currentValue;
          }
          
          // 如果没有百宝袋，隐藏选择器容器
          const container = selector.closest('.hidden');
          if (container && userData.pockets.length > 0) {
            container.classList.remove('hidden');
          }
        });
        
        // 更新存储格状态显示
        this.updateStorageStatus();
      },
      
      // 更新存储格状态
      updateStorageStatus() {
        if (!this.currentUser) return;
        
        const userData = this.getUserData(this.currentUser.id);
        if (!userData) return;
        
        let totalSlots = 0;
        let usedSlots = 0;
        
        // 如果选择了特定的百宝袋，只显示该百宝袋的状态
        if (this.selectedPocketId) {
          const selectedPocket = userData.pockets.find(p => p.id === this.selectedPocketId);
          if (selectedPocket) {
            totalSlots = selectedPocket.storageSlots;
            usedSlots = selectedPocket.usedSlots;
          }
        } else {
          // 否则显示所有百宝袋的总状态
          userData.pockets.forEach(pocket => {
            totalSlots += pocket.storageSlots;
            usedSlots += pocket.usedSlots;
          });
        }
        
        document.getElementById('usedSlots').textContent = usedSlots;
        document.getElementById('totalSlots').textContent = totalSlots;
      },
      
      // 渲染物品列表
      renderItemsList() {
        if (!this.currentUser) return;
        
        const userData = this.getUserData(this.currentUser.id);
        if (!userData) return;
        
        const itemsList = document.getElementById('itemsList');
        const emptyState = document.getElementById('emptyState');
        
        // 清空列表
        itemsList.innerHTML = '';
        
        let allItems = [];
        
        // 获取所有物品或特定百宝袋的物品
        if (this.selectedPocketId) {
          const selectedPocket = userData.pockets.find(p => p.id === this.selectedPocketId);
          if (selectedPocket) {
            allItems = selectedPocket.items.map(item => ({
              ...item,
              pocketName: selectedPocket.name,
              pocketId: selectedPocket.id
            }));
          }
        } else {
          // 获取所有百宝袋的物品
          userData.pockets.forEach(pocket => {
            pocket.items.forEach(item => {
              allItems.push({
                ...item,
                pocketName: pocket.name,
                pocketId: pocket.id
              });
            });
          });
        }
        
        // 更新物品计数
        document.getElementById('itemCount').textContent = 
          this.currentLang === 'en' 
            ? `${allItems.length} item${allItems.length !== 1 ? 's' : ''}`
            : `${allItems.length} 个物品`;
        
        if (allItems.length === 0) {
          emptyState.classList.remove('hidden');
          return;
        }
        
        emptyState.classList.add('hidden');
        
        // 渲染物品
        allItems.forEach(item => {
          const categoryColors = {
            'electronics': 'monkey-blue',
            'clothing': 'monkey-yellow',
            'accessories': 'monkey-purple',
            'documents': 'monkey-red',
            'personal': 'monkey-green',
            'other': 'gray-500'
          };
          
          const categoryLabels = {
            'electronics': this.currentLang === 'en' ? 'Electronics' : '电子产品',
            'clothing': this.currentLang === 'en' ? 'Clothing' : '衣物',
            'accessories': this.currentLang === 'en' ? 'Accessories' : '配件',
            'documents': this.currentLang === 'en' ? 'Documents' : '文件',
            'personal': this.currentLang === 'en' ? 'Personal' : '个人物品',
            'other': this.currentLang === 'en' ? 'Other' : '其他'
          };
          
          const colorClass = categoryColors[item.category] || 'gray-500';
          
          const itemElement = document.createElement('div');
          itemElement.className = 'bg-monkey-gray/50 rounded-lg p-4 border border-monkey-gray hover:border-monkey-blue/50 transition-colors';
          itemElement.innerHTML = `
            <div class="flex justify-between items-start mb-2">
              <h4 class="font-medium">${item.name}</h4>
              <span class="text-xs px-2 py-1 rounded-full bg-${colorClass}/20 text-${colorClass}">${categoryLabels[item.category]}</span>
            </div>
            <p class="text-sm text-gray-400 mb-2">${item.description}</p>
            <div class="flex justify-between items-center">
              <span class="text-xs text-gray-500">${item.pocketName}</span>
              <button class="text-gray-400 hover:text-red-400 text-sm transition-colors remove-item" data-id="${item.id}" data-pocket="${item.pocketId}">
                <i class="fa fa-trash-o mr-1"></i> ${this.currentLang === 'en' ? 'Remove' : '移除'}
              </button>
            </div>
          `;
          
          itemsList.appendChild(itemElement);
        });
        
        // 为删除按钮添加事件监听
        document.querySelectorAll('.remove-item').forEach(btn => {
          btn.addEventListener('click', () => {
            const itemId = btn.getAttribute('data-id');
            const pocketId = btn.getAttribute('data-pocket');
            this.removeItem(itemId, pocketId);
          });
        });
      },
      
      // 移除物品
      removeItem(itemId, pocketId) {
        if (!this.currentUser) return;
        
        const userData = this.getUserData(this.currentUser.id);
        if (!userData) return;
        
        // 在指定的百宝袋中查找并移除物品
        const pocketIndex = userData.pockets.findIndex(p => p.id === pocketId);
        if (pocketIndex === -1) return;
        
        const pocket = userData.pockets[pocketIndex];
        const itemIndex = pocket.items.findIndex(item => item.id === itemId);
        
        if (itemIndex !== -1) {
          // 保存物品名称用于消息显示
          const itemName = pocket.items[itemIndex].name;
          
          // 移除物品
          pocket.items.splice(itemIndex, 1);
          pocket.usedSlots--;
          
          // 保存更新后的数据
          userData.pockets[pocketIndex] = pocket;
          this.saveUserData(this.currentUser.id, userData);
          
          // 更新UI
          this.renderItemsList();
          this.updateStorageStatus();
          this.updateDashboard();
          
          // 添加活动记录
          this.addActivity(this.currentUser.id, 'remove_item', 
            this.currentLang === 'en' 
              ? `Removed item: ${itemName}` 
              : `移除了物品: ${itemName}`
          );
          
          // 显示成功消息
          this.showToast(
            this.currentLang === 'en' 
              ? 'Item removed successfully!' 
              : '物品移除成功！',
            'success'
          );
        }
      },
      
      // 更新远程取物百宝袋选择器
      updateRetrievePocketSelector() {
        const container = document.getElementById('retrievePocketSelectorContainer');
        const selector = document.getElementById('retrievePocketSelector');
        
        if (!this.currentUser) {
          container.classList.add('hidden');
          return;
        }
        
        const userData = this.getUserData(this.currentUser.id);
        if (!userData) return;
        
        if (userData.pockets.length === 0) {
          container.classList.add('hidden');
          return;
        }
        
        container.classList.remove('hidden');
        
        // 清空选项（除了第一个选项）
        while (selector.options.length > 1) {
          selector.remove(1);
        }
        
        // 添加百宝袋选项
        userData.pockets.forEach(pocket => {
          const option = document.createElement('option');
          option.value = pocket.id;
          option.textContent = `${pocket.name} (${pocket.activationCode})`;
          selector.appendChild(option);
        });
        
        // 默认选择第一个百宝袋
        if (selector.options.length > 1) {
          selector.selectedIndex = 1;
          this.selectedPocketId = selector.value;
        }
      },
      
      // 渲染可取出物品列表
      renderAvailableItemsList() {
        if (!this.currentUser || !this.selectedPocketId) return;
        
        const userData = this.getUserData(this.currentUser.id);
        if (!userData) return;
        
        const availableItemsList = document.getElementById('availableItemsList');
        const noAvailableItems = document.getElementById('noAvailableItems');
        const availableItemsCount = document.getElementById('availableItemsCount');
        
        // 清空列表
        availableItemsList.innerHTML = '';
        
        // 查找选中的百宝袋
        const selectedPocket = userData.pockets.find(p => p.id === this.selectedPocketId);
        if (!selectedPocket) return;
        
        const items = selectedPocket.items;
        
        // 更新可用物品计数
        availableItemsCount.textContent = 
          this.currentLang === 'en' 
            ? `${items.length} item${items.length !== 1 ? 's' : ''} available`
            : `${items.length} 个物品可用`;
        
        if (items.length === 0) {
          noAvailableItems.classList.remove('hidden');
          return;
        }
        
        noAvailableItems.classList.add('hidden');
        
        // 渲染物品
        items.forEach(item => {
          const categoryColors = {
            'electronics': 'monkey-blue',
            'clothing': 'monkey-yellow',
            'accessories': 'monkey-purple',
            'documents': 'monkey-red',
            'personal': 'monkey-green',
            'other': 'gray-500'
          };
          
          const categoryLabels = {
            'electronics': this.currentLang === 'en' ? 'Electronics' : '电子产品',
            'clothing': this.currentLang === 'en' ? 'Clothing' : '衣物',
            'accessories': this.currentLang === 'en' ? 'Accessories' : '配件',
            'documents': this.currentLang === 'en' ? 'Documents' : '文件',
            'personal': this.currentLang === 'en' ? 'Personal' : '个人物品',
            'other': this.currentLang === 'en' ? 'Other' : '其他'
          };
          
          const colorClass = categoryColors[item.category] || 'gray-500';
          
          const itemElement = document.createElement('div');
          itemElement.className = 'bg-monkey-gray/50 rounded-lg p-4 border border-monkey-gray hover:border-monkey-blue/50 transition-colors';
          itemElement.dataset.id = item.id;
          itemElement.innerHTML = `
            <div class="flex items-start">
              <input type="checkbox" class="retrieve-checkbox mt-1 mr-3 text-monkey-blue focus:ring-monkey-blue" data-id="${item.id}" data-name="${item.name}">
              <div class="flex-1">
                <div class="flex justify-between items-start">
                  <h4 class="font-medium">${item.name}</h4>
                  <span class="text-xs px-2 py-1 rounded-full bg-${colorClass}/20 text-${colorClass}">${categoryLabels[item.category]}</span>
                </div>
                <p class="text-sm text-gray-400 mt-1">${item.description}</p>
              </div>
            </div>
          `;
          
          availableItemsList.appendChild(itemElement);
        });
        
        // 为远程取物复选框添加事件监听
        document.querySelectorAll('.retrieve-checkbox').forEach(checkbox => {
          checkbox.addEventListener('change', (e) => {
            const itemId = checkbox.getAttribute('data-id');
            const itemName = checkbox.getAttribute('data-name');
            
            if (checkbox.checked) {
              this.selectedItemsForRetrieval.push({ id: itemId, name: itemName });
            } else {
              this.selectedItemsForRetrieval = this.selectedItemsForRetrieval.filter(item => item.id !== itemId);
            }
            
            this.updateRetrievalSelection();
          });
        });
      },
      
      // 更新远程取物选择
      updateRetrievalSelection() {
        const selectedItemsForRetrieval = document.getElementById('selectedItemsForRetrieval');
        const retrieveItemsBtn = document.getElementById('retrieveItemsBtn');
        const retrieveCostCount = document.getElementById('retrieveCostCount');
        const connectionStatus = document.getElementById('connectionStatus');
        
        if (this.selectedItemsForRetrieval.length === 0) {
          selectedItemsForRetrieval.innerHTML = `<p class="text-gray-500 text-center py-4">${this.currentLang === 'en' ? 'Please select items to retrieve from the right side' : '请从右侧选择要取出的物品'}</p>`;
          retrieveItemsBtn.disabled = true;
          retrieveCostCount.textContent = '0';
          return;
        }
        
        let itemsHTML = '<ul class="space-y-2">';
        this.selectedItemsForRetrieval.forEach(item => {
          itemsHTML += `<li class="flex items-center justify-between bg-monkey-gray/30 p-2 rounded">
            <span>${item.name}</span>
            <button class="text-gray-400 hover:text-red-400 remove-retrieval-item" data-id="${item.id}">
              <i class="fa fa-times"></i>
            </button>
          </li>`;
        });
        itemsHTML += '</ul>';
        
        selectedItemsForRetrieval.innerHTML = itemsHTML;
        retrieveItemsBtn.disabled = false;
        retrieveCostCount.textContent = this.selectedItemsForRetrieval.length;
        
        // 更新连接状态
        connectionStatus.innerHTML = `
          <div class="w-3 h-3 rounded-full bg-green-500 mr-2 animate-pulse"></div>
          <span class="text-green-400 font-medium">${this.currentLang === 'en' ? 'Connected' : '已连接'}</span>
        `;
        
        // 为移除按钮添加事件监听
        document.querySelectorAll('.remove-retrieval-item').forEach(btn => {
          btn.addEventListener('click', () => {
            const itemId = btn.getAttribute('data-id');
            this.selectedItemsForRetrieval = this.selectedItemsForRetrieval.filter(item => item.id !== itemId);
            
            // 取消对应的复选框
            const checkbox = document.querySelector(`.retrieve-checkbox[data-id="${itemId}"]`);
            if (checkbox) checkbox.checked = false;
            
            this.updateRetrievalSelection();
          });
        });
      },
      
      // 执行远程取物
      performRetrieve() {
        if (!this.currentUser || !this.selectedPocketId || this.selectedItemsForRetrieval.length === 0) return;
        
        const userData = this.getUserData(this.currentUser.id);
        if (!userData) return;
        
        // 查找选中的百宝袋
        const pocketIndex = userData.pockets.findIndex(p => p.id === this.selectedPocketId);
        if (pocketIndex === -1) return;
        
        const pocket = userData.pockets[pocketIndex];
        
        // 检查是否有足够的存储格（取物后会减少存储格）
        if (pocket.usedSlots < this.selectedItemsForRetrieval.length) {
          this.showToast(
            this.currentLang === 'en' 
              ? 'Not enough items in the pocket!' 
              : '百宝袋中的物品不足！',
            'error'
          );
          return;
        }
        
        // 确认对话框
        const confirmMsg = this.currentLang === 'en' 
          ? `Retrieving ${this.selectedItemsForRetrieval.length} item(s) will consume ${this.selectedItemsForRetrieval.length} storage slot(s). Continue?`
          : `取出 ${this.selectedItemsForRetrieval.length} 件物品将消耗 ${this.selectedItemsForRetrieval.length} 个存储格。是否继续？`;
        
        if (!confirm(confirmMsg)) return;
        
        // 模拟远程取物过程
        const retrieveItemsBtn = document.getElementById('retrieveItemsBtn');
        const retrieveSuccess = document.getElementById('retrieveSuccess');
        const retrieveError = document.getElementById('retrieveError');
        
        retrieveItemsBtn.disabled = true;
        retrieveItemsBtn.innerHTML = '<i class="fa fa-spinner fa-spin mr-2"></i>' + (this.currentLang === 'en' ? 'Retrieving...' : '正在取出...');
        retrieveSuccess.classList.add('hidden');
        retrieveError.classList.add('hidden');
        
        setTimeout(() => {
          // 模拟成功
          const successRate = Math.random();
          
          if (successRate > 0.2) { // 80% 成功率
            // 从百宝袋中移除取出的物品
            this.selectedItemsForRetrieval.forEach(selectedItem => {
              const itemIndex = pocket.items.findIndex(item => item.id === selectedItem.id);
              if (itemIndex !== -1) {
                pocket.items.splice(itemIndex, 1);
                pocket.usedSlots--;
                
                // 减少存储格总数（每取物一次消耗一个存储格）
                pocket.storageSlots--;
              }
            });
            
            // 保存更新后的数据
            userData.pockets[pocketIndex] = pocket;
            this.saveUserData(this.currentUser.id, userData);
            
            // 清空选择
            this.selectedItemsForRetrieval = [];
            
            // 更新UI
            this.updateRetrievalSelection();
            this.renderAvailableItemsList();
            this.updateStorageStatus();
            this.updateDashboard();
            
            // 添加取物记录
            const retrieveHistoryItem = {
              items: this.selectedItemsForRetrieval.map(item => item.name),
              timestamp: new Date().toISOString(),
              slotsConsumed: this.selectedItemsForRetrieval.length
            };
            
            if (!pocket.retrieveHistory) {
              pocket.retrieveHistory = [];
            }
            
            pocket.retrieveHistory.push(retrieveHistoryItem);
            
            // 添加活动记录
            this.addActivity(this.currentUser.id, 'retrieve', 
              this.currentLang === 'en' 
                ? `Retrieved ${this.selectedItemsForRetrieval.length} item(s) from Monkey Pocket` 
                : `从百宝袋中取出 ${this.selectedItemsForRetrieval.length} 件物品`
            );
            
            // 显示成功消息
            retrieveSuccess.classList.remove('hidden');
            retrieveError.classList.add('hidden');
          } else {
            // 显示错误消息
            retrieveError.classList.remove('hidden');
            retrieveSuccess.classList.add('hidden');
          }
          
          // 重置按钮
          retrieveItemsBtn.disabled = false;
          retrieveItemsBtn.innerHTML = '<i class="fa fa-download mr-2"></i>' + (this.currentLang === 'en' ? 'Retrieve Items' : '取出物品');
        }, 2000);
      },
      
      // 初始化语言
      initLanguage() {
        this.switchLanguage('zh');
      },
      
      // 切换语言
      switchLanguage(lang) {
        this.currentLang = lang;
        
        // 更新语言按钮状态
        document.querySelectorAll('.lang-btn').forEach(btn => {
          btn.classList.remove('bg-monkey-blue', 'text-white');
          btn.classList.add('text-gray-300', 'hover:text-white');
        });
        
        if (lang === 'en') {
          document.getElementById('langEN').classList.add('bg-monkey-blue', 'text-white');
          document.getElementById('langEN').classList.remove('text-gray-300', 'hover:text-white');
          document.documentElement.lang = 'en';
        } else {
          document.getElementById('langZH').classList.add('bg-monkey-blue', 'text-white');
          document.getElementById('langZH').classList.remove('text-gray-300', 'hover:text-white');
          document.documentElement.lang = 'zh-HK';
        }
        
        // 更新所有带有data-i18n属性的元素
        this.updateTranslations();
      },
      
      // 更新翻译
      updateTranslations() {
        const translations = {
          en: {
            // 用户菜单
            userMenuDashboard: "Dashboard",
            userMenuActivate: "Activate Device",
            userMenuMyPockets: "My Pockets",
            userMenuItems: "My Items",
            userMenuStorage: "Buy Storage",
            userMenuRetrieve: "Remote Retrieve",
            userMenuLogout: "Logout",
            
            // 导航
            navDashboard: "Dashboard",
            navActivate: "Activate Device",
            navMyPockets: "My Pockets",
            navItems: "My Items",
            navStorage: "Buy Storage",
            navRetrieve: "Remote Retrieve",
            
            // 认证
            authLoginTab: "Login",
            authRegisterTab: "Register",
            authLoginTitle: "Login to Your Account",
            authRegisterTitle: "Create New Account",
            authEmailLabel: "Email Address",
            authPasswordLabel: "Password",
            authRememberMe: "Remember me (Auto login for 30 days)",
            authLoginButton: "Login",
            authUsernameLabel: "Username",
            authPasswordHint: "Password must be at least 8 characters with letters and numbers",
            authConfirmPasswordLabel: "Confirm Password",
            authVerificationCodeLabel: "Email Verification Code",
            authSendCodeButton: "Send Code",
            authAgreeTerms: "I agree to the <a href='#' class='text-monkey-blue hover:underline'>Terms of Service</a> and <a href='#' class='text-monkey-blue hover:underline'>Privacy Policy</a>",
            authRegisterButton: "Register",
            authLoginErrorTitle: "Login Failed",
            authRegisterErrorTitle: "Registration Failed",
            authRegisterSuccessTitle: "Registration Successful!",
            authRegisterSuccessDesc: "Your account has been created. Please login to continue.",
            adminLoginLink: "Admin Login",
            backToUserLogin: "Back to User Login",
            
            // 仪表板
            dashboardTitle: "Welcome back, <span class='text-monkey-yellow text-shadow'>User</span>!",
            dashboardDescription: "This is your Monkey Pocket dashboard. Manage all your pockets and items from here.",
            dashboardTotalPockets: "Total Pockets",
            dashboardTotalItems: "Total Items",
            dashboardTotalStorage: "Total Storage Slots",
            dashboardQuickActions: "Quick Actions",
            dashboardAddPocket: "Add Pocket",
            dashboardAddItem: "Add Item",
            dashboardRetrieve: "Remote Retrieve",
            dashboardBuyStorage: "Buy Storage",
            dashboardRecentActivity: "Recent Activity",
            dashboardNoActivity: "No activity yet",
            
            // 激活区域
            activateTitle: "Activate Your <span class='text-monkey-yellow'>Monkey Pocket</span>",
            activateDescription: "Please follow these two steps to complete device activation",
            activateStep1: "Enter Activation Code",
            activateStep1Desc: "Find the activation code card in your Monkey Pocket packaging and enter it below to activate your device.",
            activateCodeLabel: "Activation Code",
            activateCodeHint: "Format: MK-XXXX-XXXX-XXXX (X is letter or digit)",
            activatePocketNameLabel: "Pocket Name",
            activatePocketNamePlaceholder: "e.g. My Magic Bag",
            activateButton: "Activate Device",
            activateSuccessTitle: "Activation Successful!",
            activateSuccessDesc: "Your Monkey Pocket has been successfully activated. Please proceed to step 2 to complete setup.",
            activateErrorTitle: "Activation Failed",
            
            activateStep2: "Bind IP Address & Real-name Verification",
            activateStep2Desc: "For security reasons, please bind your home IP address and complete Hong Kong ID verification.",
            ipAddressLabel: "Home IP Address",
            detectIPButton: "Auto-detect IP Address",
            fullNameLabel: "Full Name",
            fullNamePlaceholder: "Enter your full name",
            hkidLabel: "Hong Kong ID Number",
            hkidHint: "Format: 1 letter + 6 digits + 1 check digit in brackets",
            
            bindIPButton: "Bind IP Address",
            ipBindingSuccessTitle: "Binding Successful!",
            ipBindingSuccessDesc: "Your IP address has been successfully bound and real-name verification is complete. You can now start using Monkey Pocket!",
            ipBindingErrorTitle: "Binding Failed",
            
            // 我的百宝袋
            myPocketsTitle: "My <span class='text-monkey-yellow'>Pockets</span>",
            myPocketsDescription: "Manage all your Monkey Pocket devices",
            noPocketsMessage: "You haven't added any Monkey Pocket yet",
            addFirstPocketButton: "Add First Pocket",
            pocketStorage: "Storage Slots",
            pocketIP: "IP Address",
            pocketItems: "Items",
            pocketSelect: "Select this Pocket",
            
            // 物品管理
            itemsTitle: "Manage Your <span class='text-monkey-yellow'>Items</span>",
            itemsDescription: "Add, organize and manage your personal items",
            storageStatus: "Used <span id='usedSlots'>0</span>/<span id='totalSlots'>0</span> storage slots",
            addItemTitle: "Add New Item",
            itemNameLabel: "Item Name",
            itemNamePlaceholder: "e.g. Laptop, Umbrella",
            itemCategoryLabel: "Category",
            categoryElectronics: "Electronics",
            categoryClothing: "Clothing",
            categoryAccessories: "Accessories",
            categoryDocuments: "Documents",
            categoryPersonal: "Personal Items",
            categoryOther: "Other",
            itemDescriptionLabel: "Description",
            itemDescriptionPlaceholder: "Brief description of the item",
            targetPocketLabel: "Store in Pocket",
            selectPocketOption: "Select Pocket",
            addItemButton: "Add Item",
            storageFullError: "Storage is full! Please purchase more storage slots to add new items.",
            itemsListTitle: "Your Items",
            itemCount: "0 items",
            emptyStateText: "No items added yet. Start adding your items!",
            
            // 存储格购买
            storageTitle: "Buy <span class='text-monkey-yellow'>Storage Slots</span>",
            storageDescription: "Buy more storage slots to add more items!",
            selectPocketForPurchaseLabel: "Select Pocket to Buy Storage For",
            plan1Title: "Basic Plan",
            planPriceUnit: "HKD",
            plan1Feature1: "5 additional storage slots",
            plan1Feature2: "Permanent use",
            plan1Feature3: "Instant activation",
            plan2Title: "Advanced Plan",
            plan2Feature1: "13 additional storage slots",
            plan2Feature2: "Permanent use",
            plan2Feature3: "Save $60 (compared to buying 5-slot plans)",
            plan3Title: "Premium Plan",
            plan3Feature1: "30 additional storage slots",
            plan3Feature2: "Permanent use",
            plan3Feature3: "Save $250 (compared to buying 5-slot plans)",
            purchaseButton: "Purchase Now",
            popularLabel: "Most Popular",
            purchaseModalTitle: "Confirm Purchase",
            purchaseModalDesc: "You are about to purchase:",
            purchaseModalNote: "Storage slots will be added to your selected pocket immediately after purchase, valid permanently.",
            confirmPurchaseButton: "Confirm Purchase",
            cancelPurchaseButton: "Cancel",
            
            // 远程取物
            retrieveTitle: "Remote <span class='text-monkey-yellow'>Retrieve</span>",
            retrieveDescription: "Forgot an item when going out? Retrieve it remotely from your Monkey Pocket!",
            retrieveWarning: "Note: Each remote retrieval consumes one storage slot!",
            retrievePanelTitle: "Remote Retrieve Control Panel",
            selectPocketForRetrieveLabel: "Select Pocket",
            connectionStatusTitle: "Connection Status",
            connectionStatusDesc: "Connected to your Monkey Pocket",
            monkeyPocketStatus: "Monkey Pocket Status:",
            notConnected: "Not Connected",
            connected: "Connected",
            selectItemsPrompt: "Please select items to retrieve from the right side",
            retrieveCostTitle: "Retrieval Cost",
            retrieveCostDesc: "This retrieval will consume <span id='retrieveCostCount' class='font-bold'>0</span> storage slots. Total storage slots will be reduced accordingly.",
            retrieveButton: "Retrieve Items",
            clearSelectionButton: "Clear Selection",
            retrieveSuccessTitle: "Retrieve Successful!",
            retrieveSuccessDesc: "Your items have been retrieved from Monkey Pocket. Please check your Monkey Pocket.",
            retrieveErrorTitle: "Retrieve Failed",
            retrieveErrorDesc: "Unable to retrieve items from Monkey Pocket. Please check connection and try again.",
            availableItemsTitle: "Available Items",
            availableItemsCount: "0 items available",
            noAvailableItemsText: "No items available. Please add items to your Monkey Pocket first.",
            
            // 页脚
            footerDescription: "The magical pocket that transforms how you carry and manage your belongings.",
            footerProducts: "Products",
            footerProduct1: "Monkey Pocket Pro",
            footerProduct2: "Monkey Pocket Mini",
            footerProduct3: "Accessories",
            footerProduct4: "Replacement Parts",
            footerProduct5: "Gift Cards",
            footerSupport: "Support",
            footerSupport1: "Help Center",
            footerSupport2: "Contact Us",
            footerSupport3: "Warranty",
            footerSupport4: "FAQ",
            footerSupport5: "Troubleshooting",
            footerCompany: "Company",
            footerCompany1: "About Us",
            footerCompany2: "Careers",
            footerCompany3: "Press",
            footerCompany4: "Privacy Policy",
            footerCompany5: "Terms of Service",
            footerRights: "All rights reserved.",
            footerPrivacy: "Privacy Policy",
            footerTerms: "Terms of Service",
            footerCookies: "Cookie Policy",
            
            // 通用
            removeButton: "Remove",
            retrieveItemButton: "Retrieve",
            itemAddedText: "Item added successfully!",
            itemRemovedText: "Item removed successfully!",
            pocketAddedText: "Monkey Pocket added successfully!",
            pocketDeletedText: "Monkey Pocket deleted successfully!",
            purchaseSuccessText: "Purchase successful! Storage slots have been added to your pocket.",
            purchaseFailedText: "Purchase failed. Please try again.",
            confirmRetrieveText: "Are you sure you want to retrieve the selected items?",
            retrievingText: "Retrieving...",
            verificationCodeSent: "Verification code sent to your email. Valid for 5 minutes.",
            verificationCodeExpired: "Verification code expired. Please request a new one.",
            verificationCodeInvalid: "Invalid verification code.",
          },
          zh: {
            // 用户菜单
            userMenuDashboard: "仪表板",
            userMenuActivate: "激活设备",
            userMenuMyPockets: "我的百宝袋",
            userMenuItems: "我的物品",
            userMenuStorage: "购买存储格",
            userMenuRetrieve: "远程取物",
            userMenuLogout: "退出登录",
            
            // 导航
            navDashboard: "仪表板",
            navActivate: "激活设备",
            navMyPockets: "我的百宝袋",
            navItems: "我的物品",
            navStorage: "购买存储格",
            navRetrieve: "远程取物",
            
            // 认证
            authLoginTab: "登录",
            authRegisterTab: "注册",
            authLoginTitle: "登录您的账户",
            authRegisterTitle: "创建新账户",
            authEmailLabel: "邮箱地址",
            authPasswordLabel: "密码",
            authRememberMe: "记住我 (30天自动登录)",
            authLoginButton: "登录",
            authUsernameLabel: "用户名",
            authPasswordHint: "密码至少8个字符，包含字母和数字",
            authConfirmPasswordLabel: "确认密码",
            authVerificationCodeLabel: "邮箱验证码",
            authSendCodeButton: "发送验证码",
            authAgreeTerms: "我同意 <a href='#' class='text-monkey-blue hover:underline'>服务条款</a> 和 <a href='#' class='text-monkey-blue hover:underline'>隐私政策</a>",
            authRegisterButton: "注册",
            authLoginErrorTitle: "登录失败",
            authRegisterErrorTitle: "注册失败",
            authRegisterSuccessTitle: "注册成功!",
            authRegisterSuccessDesc: "您的账户已创建，请登录以继续。",
            adminLoginLink: "管理员登录",
            backToUserLogin: "返回用户登录",
            
            // 仪表板
            dashboardTitle: "欢迎回来, <span class='text-monkey-yellow text-shadow'>用户</span>!",
            dashboardDescription: "这是您的Monkey Pocket仪表板，从这里管理您的所有百宝袋和物品。",
            dashboardTotalPockets: "百宝袋总数",
            dashboardTotalItems: "物品总数",
            dashboardTotalStorage: "总存储格",
            dashboardQuickActions: "快速操作",
            dashboardAddPocket: "添加百宝袋",
            dashboardAddItem: "添加物品",
            dashboardRetrieve: "远程取物",
            dashboardBuyStorage: "购买存储格",
            dashboardRecentActivity: "最近活动",
            dashboardNoActivity: "暂无活动记录",
            
            // 激活区域
            activateTitle: "激活你的<span class='text-monkey-yellow'>Monkey Pocket</span>",
            activateDescription: "请按照以下两个步骤完成设备激活",
            activateStep1: "输入激活码和密码",
            activateStep1Desc: "请在您的Monkey Pocket包装盒内找到激活码卡片，输入下方以激活您的设备。",
            activateCodeLabel: "激活码",
            activateCodeHint: "激活码格式: MK-XXXX-XXXX-XXXX (X为字母或数字)",
            activatePocketNameLabel: "百宝袋名称",
            activatePocketNamePlaceholder: "例如: 我的魔法袋",
            activateButton: "激活设备",
            activateSuccessTitle: "激活成功!",
            activateSuccessDesc: "您的Monkey Pocket已成功激活。请继续步骤2以完成设置。",
            activateErrorTitle: "激活失败",
            
            activateStep2: "绑定IP地址与实名认证",
            activateStep2Desc: "为了安全起见，请绑定您家庭的IP地址并进行香港身份证实名认证。",
            ipAddressLabel: "家庭IP地址",
            detectIPButton: "自动检测IP地址",
            fullNameLabel: "姓名",
            fullNamePlaceholder: "请输入您的全名",
            hkidLabel: "香港身份证号码",
            hkidHint: "格式: 1个字母 + 6位数字 + 括号内1位校验码",
            bindIPButton: "绑定IP地址",
            ipBindingSuccessTitle: "绑定成功!",
            ipBindingSuccessDesc: "您的IP地址已成功绑定，实名认证已完成。现在可以开始使用Monkey Pocket了!",
            ipBindingErrorTitle: "绑定失败",
            
            // 我的百宝袋
            myPocketsTitle: "我的<span class='text-monkey-yellow'>百宝袋</span>",
            myPocketsDescription: "管理您所有的Monkey Pocket设备",
            noPocketsMessage: "您尚未添加任何Monkey Pocket",
            addFirstPocketButton: "添加第一个百宝袋",
            pocketStorage: "存储格",
            pocketIP: "IP地址",
            pocketItems: "物品数量",
            pocketSelect: "选择此百宝袋",
            
            // 物品管理
            itemsTitle: "管理你的<span class='text-monkey-yellow'>物品</span>",
            itemsDescription: "添加、组织和管理您的个人物品",
            storageStatus: "已使用 <span id='usedSlots'>0</span>/<span id='totalSlots'>0</span> 存储格",
            addItemTitle: "添加新物品",
            itemNameLabel: "物品名称",
            itemNamePlaceholder: "例如: 笔记本电脑、雨伞",
            itemCategoryLabel: "类别",
            categoryElectronics: "电子产品",
            categoryClothing: "衣物",
            categoryAccessories: "配件",
            categoryDocuments: "文件",
            categoryPersonal: "个人物品",
            categoryOther: "其他",
            itemDescriptionLabel: "描述",
            itemDescriptionPlaceholder: "物品的简要描述",
            targetPocketLabel: "存入百宝袋",
            selectPocketOption: "选择百宝袋",
            addItemButton: "添加物品",
            storageFullError: "存储格已满！请购买更多存储格以添加新物品。",
            itemsListTitle: "你的物品",
            itemCount: "0 个物品",
            emptyStateText: "尚未添加任何物品。开始添加您的物品吧！",
            
            // 存储格购买
            storageTitle: "购买<span class='text-monkey-yellow'>存储格</span>",
            storageDescription: "购买更多存储格以添加更多物品！",
            selectPocketForPurchaseLabel: "选择要购买存储格的百宝袋",
            plan1Title: "基础套餐",
            planPriceUnit: "HKD",
            plan1Feature1: "5 个额外存储格",
            plan1Feature2: "永久使用",
            plan1Feature3: "即时生效",
            plan2Title: "进阶套餐",
            plan2Feature1: "13 个额外存储格",
            plan2Feature2: "永久使用",
            plan2Feature3: "节省 $60 (比单买5格套餐)",
            plan3Title: "高级套餐",
            plan3Feature1: "30 个额外存储格",
            plan3Feature2: "永久使用",
            plan3Feature3: "节省 $250 (比单买5格套餐)",
            purchaseButton: "立即购买",
            popularLabel: "最受欢迎",
            purchaseModalTitle: "确认购买",
            purchaseModalDesc: "您即将购买：",
            purchaseModalNote: "购买后存储格将立即添加到您选择的百宝袋，永久有效。",
            confirmPurchaseButton: "确认购买",
            cancelPurchaseButton: "取消",
            
            // 远程取物
            retrieveTitle: "远程<span class='text-monkey-yellow'>取物</span>",
            retrieveDescription: "外出时忘记带物品？远程从您的Monkey Pocket中取出！",
            retrieveWarning: "注意：每次远程取物会消耗一个存储格！",
            retrievePanelTitle: "远程取物控制面板",
            selectPocketForRetrieveLabel: "选择百宝袋",
            connectionStatusTitle: "连接状态",
            connectionStatusDesc: "与您的Monkey Pocket连接",
            monkeyPocketStatus: "Monkey Pocket状态:",
            notConnected: "未连接",
            connected: "已连接",
            selectItemsPrompt: "请从右侧选择要取出的物品",
            retrieveCostTitle: "取物消耗",
            retrieveCostDesc: "本次取物将消耗 <span id='retrieveCostCount' class='font-bold'>0</span> 个存储格。取物后存储格总数将相应减少。",
            retrieveButton: "取出物品",
            clearSelectionButton: "清空选择",
            retrieveSuccessTitle: "取出成功!",
            retrieveSuccessDesc: "您的物品已从Monkey Pocket中取出。请检查您的Monkey Pocket。",
            retrieveErrorTitle: "取出失败",
            retrieveErrorDesc: "无法从Monkey Pocket中取出物品。请检查连接后重试。",
            availableItemsTitle: "可取出物品",
            availableItemsCount: "0 个物品可用",
            noAvailableItemsText: "暂无可用物品。请先添加物品到您的Monkey Pocket。",
            
            // 页脚
            footerDescription: "魔法百宝袋，改变您携带和管理物品的方式。",
            footerProducts: "产品",
            footerProduct1: "Monkey Pocket Pro",
            footerProduct2: "Monkey Pocket Mini",
            footerProduct3: "配件",
            footerProduct4: "替换零件",
            footerProduct5: "礼品卡",
            footerSupport: "支持",
            footerSupport1: "帮助中心",
            footerSupport2: "联系我们",
            footerSupport3: "保修",
            footerSupport4: "常见问题",
            footerSupport5: "故障排除",
            footerCompany: "公司",
            footerCompany1: "关于我们",
            footerCompany2: "招聘",
            footerCompany3: "新闻",
            footerCompany4: "隐私政策",
            footerCompany5: "服务条款",
            footerRights: "版权所有。",
            footerPrivacy: "隐私政策",
            footerTerms: "服务条款",
            footerCookies: "Cookie政策",
            
            // 通用
            removeButton: "移除",
            retrieveItemButton: "取出",
            itemAddedText: "物品添加成功！",
            itemRemovedText: "物品移除成功！",
            pocketAddedText: "百宝袋添加成功！",
            pocketDeletedText: "百宝袋删除成功！",
            purchaseSuccessText: "购买成功！存储格已添加到您的百宝袋。",
            purchaseFailedText: "购买失败，请重试。",
            confirmRetrieveText: "确定要取出选中的物品吗？",
            retrievingText: "正在取出...",
            verificationCodeSent: "验证码已发送到您的邮箱，5分钟内有效。",
            verificationCodeExpired: "验证码已过期，请重新获取。",
            verificationCodeInvalid: "验证码不正确。",
          }
        };
        
        // 更新所有带有data-i18n属性的元素
        document.querySelectorAll('[data-i18n]').forEach(element => {
          const key = element.getAttribute('data-i18n');
          if (translations[this.currentLang][key]) {
            if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA' || element.tagName === 'SELECT') {
              element.placeholder = translations[this.currentLang][key];
            } else {
              element.innerHTML = translations[this.currentLang][key];
            }
          }
        });
        
        // 更新带有data-i18n-placeholder属性的元素
        document.querySelectorAll('[data-i18n-placeholder]').forEach(element => {
          const key = element.getAttribute('data-i18n-placeholder');
          if (translations[this.currentLang][key]) {
            element.placeholder = translations[this.currentLang][key];
          }
        });
        
        // 更新动态内容
        this.updateStorageStatus();
        this.renderItemsList();
        this.updateRetrievalSelection();
      },
      
      // 显示Toast通知
      showToast(message, type = 'success') {
        // 创建Toast元素
        const toast = document.createElement('div');
        toast.className = `fixed top-24 right-4 z-50 px-4 py-3 rounded-lg shadow-lg transform transition-all duration-300 translate-x-full ${type === 'success' ? 'bg-monkey-green/90' : 'bg-monkey-red/90'}`;
        toast.innerHTML = `
          <div class="flex items-center">
            <i class="fa ${type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle'} mr-3"></i>
            <span>${message}</span>
          </div>
        `;
        
        document.body.appendChild(toast);
        
        // 显示Toast
        setTimeout(() => {
          toast.classList.remove('translate-x-full');
          toast.classList.add('translate-x-0');
        }, 10);
        
        // 3秒后隐藏并移除Toast
        setTimeout(() => {
          toast.classList.remove('translate-x-0');
          toast.classList.add('translate-x-full');
          
          setTimeout(() => {
            document.body.removeChild(toast);
          }, 300);
        }, 3000);
      },
      
      // 设置事件监听器
      setupEventListeners() {
        // 语言切换
        document.getElementById('langEN').addEventListener('click', () => this.switchLanguage('en'));
        document.getElementById('langZH').addEventListener('click', () => this.switchLanguage('zh'));
        
        // 导航栏滚动效果
        window.addEventListener('scroll', () => {
          const navbar = document.getElementById('navbar');
          if (window.scrollY > 50) {
            navbar.classList.add('py-2', 'bg-monkey-darker/95');
            navbar.classList.remove('py-4', 'bg-monkey-darker/80');
          } else {
            navbar.classList.add('py-4', 'bg-monkey-darker/80');
            navbar.classList.remove('py-2', 'bg-monkey-darker/95');
          }
        });
        
        // 移动端菜单
        const menuBtn = document.getElementById('menuBtn');
        const mobileMenu = document.getElementById('mobileMenu');
        
        menuBtn.addEventListener('click', () => {
          mobileMenu.classList.toggle('hidden');
          if (mobileMenu.classList.contains('hidden')) {
            menuBtn.innerHTML = '<i class="fa fa-bars text-2xl"></i>';
          } else {
            menuBtn.innerHTML = '<i class="fa fa-times text-2xl"></i>';
          }
        });
        
        // 平滑滚动和页面切换
        document.querySelectorAll('.page-link').forEach(anchor => {
          anchor.addEventListener('click', (e) => {
            e.preventDefault();
            
            const targetId = anchor.getAttribute('href').substring(1);
            
            if (this.currentAdmin) {
              this.showAdminPage(targetId);
            } else if (this.currentUser) {
              this.showPage(targetId);
            } else {
              // 如果用户未登录，显示登录页面
              this.showAuthPage();
            }
            
            // 关闭移动端菜单
            if (!mobileMenu.classList.contains('hidden')) {
              mobileMenu.classList.add('hidden');
              menuBtn.innerHTML = '<i class="fa fa-bars text-2xl"></i>';
            }
            
            // 滚动到顶部
            window.scrollTo({
              top: 0,
              behavior: 'smooth'
            });
          });
        });
        
        // Logo点击返回仪表板
        document.getElementById('logoHome').addEventListener('click', (e) => {
          e.preventDefault();
          if (this.currentAdmin) {
            this.showAdminPage('adminDashboard');
          } else if (this.currentUser) {
            this.showPage('dashboard');
          }
          window.scrollTo({
            top: 0,
            behavior: 'smooth'
          });
        });
        
        // 用户菜单
        const userMenuBtn = document.getElementById('userMenuBtn');
        const userDropdown = document.getElementById('userDropdown');
        
        if (userMenuBtn) {
          userMenuBtn.addEventListener('click', () => {
            userDropdown.classList.toggle('hidden');
          });
        }
        
        // 管理员菜单
        const adminMenuBtn = document.getElementById('adminMenuBtn');
        const adminDropdown = document.getElementById('adminDropdown');
        
        if (adminMenuBtn) {
          adminMenuBtn.addEventListener('click', () => {
            adminDropdown.classList.toggle('hidden');
          });
        }
        
        // 点击外部关闭用户菜单
        document.addEventListener('click', (e) => {
          if (userMenuBtn && !userMenuBtn.contains(e.target) && userDropdown && !userDropdown.contains(e.target)) {
            userDropdown.classList.add('hidden');
          }
          
          if (adminMenuBtn && !adminMenuBtn.contains(e.target) && adminDropdown && !adminDropdown.contains(e.target)) {
            adminDropdown.classList.add('hidden');
          }
        });
        
        // 用户菜单项点击
        document.querySelectorAll('.user-menu-item').forEach(item => {
          item.addEventListener('click', (e) => {
            e.preventDefault();
            const targetId = item.getAttribute('href').substring(1);
            this.showPage(targetId);
            userDropdown.classList.add('hidden');
          });
        });
        
        // 管理员菜单项点击
        document.querySelectorAll('.admin-menu-item').forEach(item => {
          item.addEventListener('click', (e) => {
            e.preventDefault();
            const targetId = item.getAttribute('href').substring(1);
            this.showAdminPage(targetId);
            adminDropdown.classList.add('hidden');
          });
        });
        
        // 退出登录
        document.getElementById('logoutBtn').addEventListener('click', () => this.logout());
        document.getElementById('mobileLogoutBtn').addEventListener('click', () => this.logout());
        
        // 退出管理员
        document.getElementById('adminLogoutBtn').addEventListener('click', () => this.adminLogout());
        document.getElementById('mobileAdminLogoutBtn').addEventListener('click', () => this.adminLogout());
        
        // 登录/注册切换
        document.getElementById('showLogin').addEventListener('click', () => this.showLoginForm());
        document.getElementById('showRegister').addEventListener('click', () => this.showRegisterForm());
        
        // 管理员登录切换
        document.getElementById('showAdminLogin').addEventListener('click', () => this.showAdminLoginForm());
        document.getElementById('backToUserLogin').addEventListener('click', () => this.showLoginForm());
        
        // 登录表单提交
        document.getElementById('loginFormElement').addEventListener('submit', (e) => {
          e.preventDefault();
          this.handleLogin();
        });
        
        // 注册表单提交
        document.getElementById('registerFormElement').addEventListener('submit', (e) => {
          e.preventDefault();
          this.handleRegister();
        });
        
        // 管理员登录表单提交
        document.getElementById('adminLoginFormElement').addEventListener('submit', (e) => {
          e.preventDefault();
          this.handleAdminLogin();
        });
        
        // 发送邮箱验证码
        document.getElementById('sendVerificationCode').addEventListener('click', () => this.handleSendVerificationCode());
        
        // 激活设备
        document.getElementById('activateDeviceBtn').addEventListener('click', () => this.handleActivation());
        
        // 自动检测IP地址
        document.getElementById('detectIPBtn').addEventListener('click', (e) => {
          e.preventDefault();
          this.autoDetectIP();
        });
        
        // 绑定IP地址
        document.getElementById('bindIPBtn').addEventListener('click', () => this.handleIPBinding());
        
        // 添加物品
        document.getElementById('itemForm').addEventListener('submit', (e) => {
          e.preventDefault();
          this.handleAddItem();
        });
        
        // 百宝袋选择器更改
        const pocketSelector = document.getElementById('pocketSelector');
        if (pocketSelector) {
          pocketSelector.addEventListener('change', (e) => {
            this.selectedPocketId = e.target.value;
            this.renderItemsList();
            this.updateStorageStatus();
          });
        }
        
        // 购买存储格按钮
        document.querySelectorAll('.purchase-btn').forEach(btn => {
          btn.addEventListener('click', (e) => {
            this.handlePurchaseButtonClick(e.target);
          });
        });
        
        // 购买模态框
        document.getElementById('closePurchaseModal').addEventListener('click', () => this.closePurchaseModal());
        document.getElementById('cancelPurchase').addEventListener('click', () => this.closePurchaseModal());
        document.getElementById('confirmPurchase').addEventListener('click', () => this.handlePurchase());
        
        // 远程取物百宝袋选择器
        const retrievePocketSelector = document.getElementById('retrievePocketSelector');
        if (retrievePocketSelector) {
          retrievePocketSelector.addEventListener('change', (e) => {
            this.selectedPocketId = e.target.value;
            this.renderAvailableItemsList();
          });
        }
        
        // 远程取物
        document.getElementById('retrieveItemsBtn').addEventListener('click', () => this.performRetrieve());
        
        // 清空选择
        document.getElementById('clearSelectionBtn').addEventListener('click', () => {
          this.selectedItemsForRetrieval = [];
          this.updateRetrievalSelection();
          
          // 取消所有复选框
          document.querySelectorAll('.retrieve-checkbox').forEach(checkbox => {
            checkbox.checked = false;
          });
        });
        
        // 生成激活码按钮
        document.getElementById('generateCodesBtn').addEventListener('click', () => this.handleGenerateCodes());
        
        // 复制所有激活码按钮
        document.getElementById('copyAllCodes').addEventListener('click', () => this.copyAllCodesToClipboard());
        
        // 搜索用户
        document.getElementById('searchUsers').addEventListener('input', (e) => {
          this.searchUsers(e.target.value);
        });
        
        // 搜索百宝袋
        document.getElementById('searchPockets').addEventListener('input', (e) => {
          this.searchPockets(e.target.value);
        });
        
        // 搜索激活码
        document.getElementById('searchCodes').addEventListener('input', (e) => {
          this.searchCodes(e.target.value);
        });
        
        // 激活码状态筛选
        document.getElementById('filterCodeStatus').addEventListener('change', (e) => {
          this.filterCodesByStatus(e.target.value);
        });
      },
      
      // 处理登录
      handleLogin() {
        const email = document.getElementById('loginEmail').value.trim();
        const password = document.getElementById('loginPassword').value.trim();
        const rememberMe = document.getElementById('rememberMe').checked;
        
        const loginError = document.getElementById('loginError');
        const loginErrorMsg = document.getElementById('loginErrorMsg');
        
        // 简单验证
        if (!email || !password) {
          loginErrorMsg.textContent = this.currentLang === 'en' 
            ? 'Please enter email and password.' 
            : '请输入邮箱和密码。';
          loginError.classList.remove('hidden');
          return;
        }
        
        // 查找用户
        const user = this.users[email];
        if (!user || user.password !== password) {
          loginErrorMsg.textContent = this.currentLang === 'en' 
            ? 'Incorrect email or password.' 
            : '邮箱或密码不正确。';
          loginError.classList.remove('hidden');
          return;
        }
        
        // 登录成功
        loginError.classList.add('hidden');
        this.saveCurrentUser(user, rememberMe);
      },
      
      // 处理管理员登录
      handleAdminLogin() {
        const username = document.getElementById('adminUsername').value.trim();
        const password = document.getElementById('adminPassword').value.trim();
        
        const adminLoginError = document.getElementById('adminLoginError');
        const adminLoginErrorMsg = document.getElementById('adminLoginErrorMsg');
        
        // 验证管理员凭据
        if (username === this.adminUsername && password === this.adminPassword) {
          // 登录成功
          adminLoginError.classList.add('hidden');
          this.saveCurrentAdmin({ username });
        } else {
          // 登录失败
          adminLoginErrorMsg.textContent = '管理员账号或密码不正确';
          adminLoginError.classList.remove('hidden');
        }
      },
      
      // 处理发送邮箱验证码
      handleSendVerificationCode() {
        const email = document.getElementById('registerEmail').value.trim();
        const sendCodeBtn = document.getElementById('sendVerificationCode');
        const verificationTimer = document.getElementById('verificationTimer');
        
        if (!email) {
          this.showToast(
            this.currentLang === 'en' 
              ? 'Please enter your email address first.' 
              : '请先输入您的邮箱地址。',
            'error'
          );
          return;
        }
        
        // 检查邮箱是否已注册
        if (this.users[email]) {
          this.showToast(
            this.currentLang === 'en' 
              ? 'Email already registered.' 
              : '邮箱已被注册。',
            'error'
          );
          return;
        }
        
        // 生成验证码
        const verificationCode = this.generateVerificationCode();
        
        // 保存验证码到内存（有效5分钟）
        this.emailVerificationCodes[email] = {
          code: verificationCode,
          expiry: Date.now() + 5 * 60 * 1000 // 5分钟
        };
        
        // 禁用发送按钮并开始倒计时
        sendCodeBtn.disabled = true;
        sendCodeBtn.textContent = this.currentLang === 'en' ? 'Resend in 300s' : '300秒后重发';
        
        let timeLeft = 300;
        const timerInterval = setInterval(() => {
          timeLeft--;
          verificationTimer.textContent = this.currentLang === 'en' 
            ? `Code valid for ${timeLeft}s` 
            : `验证码有效时间: ${timeLeft}秒`;
          
          sendCodeBtn.textContent = this.currentLang === 'en' 
            ? `Resend in ${timeLeft}s` 
            : `${timeLeft}秒后重发`;
          
          if (timeLeft <= 0) {
            clearInterval(timerInterval);
            sendCodeBtn.disabled = false;
            sendCodeBtn.textContent = this.currentLang === 'en' ? 'Send Code' : '发送验证码';
            verificationTimer.textContent = '';
          }
        }, 1000);
        
        // 显示验证码（实际应用中应通过后端发送邮件）
        this.showToast(
          this.currentLang === 'en' 
            ? `Verification code sent to ${email}: ${verificationCode}` 
            : `验证码已发送到 ${email}: ${verificationCode}`,
          'success'
        );
      },
      
      // 处理注册
      handleRegister() {
        const username = document.getElementById('registerUsername').value.trim();
        const email = document.getElementById('registerEmail').value.trim();
        const password = document.getElementById('registerPassword').value.trim();
        const confirmPassword = document.getElementById('registerConfirmPassword').value.trim();
        const verificationCode = document.getElementById('registerVerificationCode').value.trim();
        const agreeTerms = document.getElementById('agreeTerms').checked;
        
        const registerError = document.getElementById('registerError');
        const registerErrorMsg = document.getElementById('registerErrorMsg');
        const registerSuccess = document.getElementById('registerSuccess');
        
        // 验证输入
        if (!username || !email || !password || !confirmPassword || !verificationCode) {
          registerErrorMsg.textContent = this.currentLang === 'en' 
            ? 'Please fill in all fields.' 
            : '请填写所有字段。';
          registerError.classList.remove('hidden');
          registerSuccess.classList.add('hidden');
          return;
        }
        
        if (!agreeTerms) {
          registerErrorMsg.textContent = this.currentLang === 'en' 
            ? 'You must agree to the terms and conditions.' 
            : '您必须同意服务条款和隐私政策。';
          registerError.classList.remove('hidden');
          registerSuccess.classList.add('hidden');
          return;
        }
        
        if (password !== confirmPassword) {
          registerErrorMsg.textContent = this.currentLang === 'en' 
            ? 'Passwords do not match.' 
            : '密码不匹配。';
          registerError.classList.remove('hidden');
          registerSuccess.classList.add('hidden');
          return;
        }
        
        if (password.length < 8 || !/\d/.test(password) || !/[a-zA-Z]/.test(password)) {
          registerErrorMsg.textContent = this.currentLang === 'en' 
            ? 'Password must be at least 8 characters with letters and numbers.' 
            : '密码必须至少8个字符，包含字母和数字。';
          registerError.classList.remove('hidden');
          registerSuccess.classList.add('hidden');
          return;
        }
        
        // 检查邮箱是否已注册
        if (this.users[email]) {
          registerErrorMsg.textContent = this.currentLang === 'en' 
            ? 'Email already registered.' 
            : '邮箱已被注册。';
          registerError.classList.remove('hidden');
          registerSuccess.classList.add('hidden');
          return;
        }
        
        // 验证验证码
        const savedCode = this.emailVerificationCodes[email];
        if (!savedCode) {
          registerErrorMsg.textContent = this.currentLang === 'en' 
            ? 'Please request a verification code first.' 
            : '请先获取验证码。';
          registerError.classList.remove('hidden');
          registerSuccess.classList.add('hidden');
          return;
        }
        
        if (Date.now() > savedCode.expiry) {
          registerErrorMsg.textContent = this.currentLang === 'en' 
            ? 'Verification code has expired. Please request a new one.' 
            : '验证码已过期，请重新获取。';
          registerError.classList.remove('hidden');
          registerSuccess.classList.add('hidden');
          return;
        }
        
        if (savedCode.code !== verificationCode) {
          registerErrorMsg.textContent = this.currentLang === 'en' 
            ? 'Invalid verification code.' 
            : '验证码不正确。';
          registerError.classList.remove('hidden');
          registerSuccess.classList.add('hidden');
          return;
        }
        
        // 创建新用户
        const newUser = {
          id: 'user_' + Date.now(),
          username,
          email,
          password, // 实际应用中应加密存储
          createdAt: new Date().toISOString(),
          lastLogin: null,
          rememberMe: false
        };
        
        // 保存用户
        this.users[email] = newUser;
        localStorage.setItem('monkeyPocketUsers', JSON.stringify(this.users));
        
        // 初始化用户数据
        const userData = {
          pockets: [],
          recentActivity: []
        };
        
        localStorage.setItem(`user_${newUser.id}_data`, JSON.stringify(userData));
        
        // 清除验证码
        delete this.emailVerificationCodes[email];
        
        // 显示成功消息
        registerError.classList.add('hidden');
        registerSuccess.classList.remove('hidden');
        
        // 重置表单
        document.getElementById('registerFormElement').reset();
        
        // 重置验证码按钮
        const sendCodeBtn = document.getElementById('sendVerificationCode');
        sendCodeBtn.disabled = false;
        sendCodeBtn.textContent = this.currentLang === 'en' ? 'Send Code' : '发送验证码';
        document.getElementById('verificationTimer').textContent = '';
        
        // 3秒后切换到登录表单
        setTimeout(() => {
          this.showLoginForm();
          registerSuccess.classList.add('hidden');
        }, 3000);
      },
      
      // 处理激活
      handleActivation() {
        const activationCode = document.getElementById('activationCode').value.trim().toUpperCase();
        const activationPassword = document.getElementById('activationPassword').value.trim();
        const pocketName = document.getElementById('pocketName').value.trim();
        
        const activationSuccess = document.getElementById('activationSuccess');
        const activationError = document.getElementById('activationError');
        const activationErrorMsg = document.getElementById('activationErrorMsg');
        
        // 简单验证激活码格式
        if (!activationCode || !activationCode.match(/^MK-[A-Z0-9]{4}-[A-Z0-9]{4}-[A-Z0-9]{4}$/)) {
          activationErrorMsg.textContent = this.currentLang === 'en' 
            ? "Invalid activation code format. Please check and try again." 
            : "激活码格式无效。请检查后重试。";
          activationError.classList.remove('hidden');
          activationSuccess.classList.add('hidden');
          return;
        }
        
        if (!activationPassword) {
          activationErrorMsg.textContent = this.currentLang === 'en' 
            ? "Please enter activation password." 
            : "请输入激活密码。";
          activationError.classList.remove('hidden');
          activationSuccess.classList.add('hidden');
          return;
        }
        
        if (!pocketName) {
          activationErrorMsg.textContent = this.currentLang === 'en' 
            ? "Please enter a pocket name." 
            : "请输入百宝袋名称。";
          activationError.classList.remove('hidden');
          activationSuccess.classList.add('hidden');
          return;
        }
        
        // 检查激活码是否存在
        const codeData = this.activationCodes[activationCode];
        if (!codeData) {
          activationErrorMsg.textContent = this.currentLang === 'en' 
            ? "Activation code not found." 
            : "激活码不存在。";
          activationError.classList.remove('hidden');
          activationSuccess.classList.add('hidden');
          return;
        }
        
        // 检查激活码是否已被使用
        if (codeData.used) {
          activationErrorMsg.textContent = this.currentLang === 'en' 
            ? "Activation code has already been used." 
            : "激活码已被使用。";
          activationError.classList.remove('hidden');
          activationSuccess.classList.add('hidden');
          return;
        }
        
        // 检查密码是否正确
        if (codeData.password !== activationPassword) {
          activationErrorMsg.textContent = this.currentLang === 'en' 
            ? "Incorrect activation password." 
            : "激活密码不正确。";
          activationError.classList.remove('hidden');
          activationSuccess.classList.add('hidden');
          return;
        }
        
        // 检查激活码是否过期
        if (codeData.expiresAt && new Date(codeData.expiresAt) < new Date()) {
          activationErrorMsg.textContent = this.currentLang === 'en' 
            ? "Activation code has expired." 
            : "激活码已过期。";
          activationError.classList.remove('hidden');
          activationSuccess.classList.add('hidden');
          return;
        }
        
        // 模拟激活过程
        const activateDeviceBtn = document.getElementById('activateDeviceBtn');
        activateDeviceBtn.disabled = true;
        activateDeviceBtn.innerHTML = '<i class="fa fa-spinner fa-spin mr-2"></i>' + (this.currentLang === 'en' ? 'Activating...' : '激活中...');
        
        setTimeout(() => {
          // 模拟成功激活
          activationSuccess.classList.remove('hidden');
          activationError.classList.add('hidden');
          
          // 启用IP绑定表单
          document.getElementById('ipAddress').disabled = false;
          document.getElementById('fullName').disabled = false;
          document.getElementById('hkid').disabled = false;
          document.getElementById('bindIPBtn').disabled = false;
          
          // 保存激活码到临时存储
          sessionStorage.setItem('pendingActivationCode', activationCode);
          sessionStorage.setItem('pendingPocketName', pocketName);
          
          // 更新百宝袋选择器
          this.updatePocketSelectors();
          
          // 重置按钮
          activateDeviceBtn.disabled = false;
          activateDeviceBtn.textContent = this.currentLang === 'en' ? 'Device Activated' : '设备已激活';
          activateDeviceBtn.classList.add('bg-monkey-green', 'hover:bg-monkey-green/90');
          activateDeviceBtn.classList.remove('bg-monkey-blue', 'hover:bg-monkey-blue/90');
          
          // 自动填充IP地址
          document.getElementById('ipAddress').value = this.generateRandomIP();
        }, 1500);
      },
      
      // 自动检测IP地址
      autoDetectIP() {
        document.getElementById('ipAddress').value = this.generateRandomIP();
      },
      
      // 生成随机IP地址
      generateRandomIP() {
        return `192.168.${Math.floor(Math.random() * 255)}.${Math.floor(Math.random() * 255)}`;
      },
      
      // 验证香港身份证号码格式
      validateHKID(hkid) {
        // 香港身份证号码格式：1个字母 + 6位数字 + 括号内1位校验码（数字或字母）
        const hkidRegex = /^[A-Z]{1}[0-9]{6}\([0-9A-Z]{1}\)$/;
        return hkidRegex.test(hkid);
      },
      
      // 处理IP绑定
      handleIPBinding() {
        const ipAddress = document.getElementById('ipAddress').value.trim();
        const fullName = document.getElementById('fullName').value.trim();
        const hkid = document.getElementById('hkid').value.trim().toUpperCase();
        
        const ipBindingSuccess = document.getElementById('ipBindingSuccess');
        const ipBindingError = document.getElementById('ipBindingError');
        const ipBindingErrorMsg = document.getElementById('ipBindingErrorMsg');
        
        // 验证输入
        if (!ipAddress || !fullName || !hkid) {
          ipBindingErrorMsg.textContent = this.currentLang === 'en'
            ? "Please fill in all fields."
            : "请填写所有字段。";
          ipBindingError.classList.remove('hidden');
          ipBindingSuccess.classList.add('hidden');
          return;
        }
        
        // 验证香港身份证号码
        if (!this.validateHKID(hkid)) {
          ipBindingErrorMsg.textContent = this.currentLang === 'en'
            ? "Invalid Hong Kong ID number format. Please check and try again."
            : "香港身份证号码格式不正确。请检查后重试。";
          ipBindingError.classList.remove('hidden');
          ipBindingSuccess.classList.add('hidden');
          return;
        }
        
        // 模拟绑定过程
        const bindIPBtn = document.getElementById('bindIPBtn');
        bindIPBtn.disabled = true;
        bindIPBtn.innerHTML = '<i class="fa fa-spinner fa-spin mr-2"></i>' + (this.currentLang === 'en' ? 'Binding...' : '绑定中...');
        
        setTimeout(() => {
          // 获取激活码和百宝袋名称
          const activationCode = sessionStorage.getItem('pendingActivationCode');
          const pocketName = sessionStorage.getItem('pendingPocketName');
          
          if (!this.currentUser || !activationCode || !pocketName) {
            ipBindingErrorMsg.textContent = this.currentLang === 'en'
              ? "Activation data not found. Please try again."
              : "未找到激活数据。请重试。";
            ipBindingError.classList.remove('hidden');
            ipBindingSuccess.classList.add('hidden');
            bindIPBtn.disabled = false;
            bindIPBtn.textContent = this.currentLang === 'en' ? 'Bind IP Address' : '绑定IP地址';
            return;
          }
          
          const userData = this.getUserData(this.currentUser.id);
          if (!userData) return;
          
          // 检查是否已存在相同激活码的百宝袋
          const existingPocket = userData.pockets.find(p => p.activationCode === activationCode);
          if (existingPocket) {
            ipBindingErrorMsg.textContent = this.currentLang === 'en'
              ? "This Monkey Pocket has already been activated."
              : "此百宝袋已被激活。";
            ipBindingError.classList.remove('hidden');
            ipBindingSuccess.classList.add('hidden');
            bindIPBtn.disabled = false;
            bindIPBtn.textContent = this.currentLang === 'en' ? 'Bind IP Address' : '绑定IP地址';
            return;
          }
          
          // 创建新的百宝袋
          const newPocket = {
            id: 'pocket_' + Date.now(),
            userId: this.currentUser.id,
            activationCode,
            name: pocketName,
            ipAddress,
            fullName,
            hkid,
            storageSlots: 15, // 初始15个免费存储格
            usedSlots: 0,
            purchasedSlots: 0,
            items: [],
            purchaseHistory: [],
            retrieveHistory: [],
            createdAt: new Date().toISOString()
          };
          
          // 添加到用户数据
          userData.pockets.push(newPocket);
          this.saveUserData(this.currentUser.id, userData);
          
          // 更新激活码状态
          if (this.activationCodes[activationCode]) {
            this.activationCodes[activationCode].used = true;
            this.activationCodes[activationCode].userId = this.currentUser.id;
            this.activationCodes[activationCode].pocketId = newPocket.id;
            this.activationCodes[activationCode].activatedAt = new Date().toISOString();
            this.saveActivationCodesToStorage();
          }
          
          // 清除临时存储
          sessionStorage.removeItem('pendingActivationCode');
          sessionStorage.removeItem('pendingPocketName');
          
          // 显示成功消息
          ipBindingSuccess.classList.remove('hidden');
          ipBindingError.classList.add('hidden');
          
          // 重置按钮
          bindIPBtn.disabled = false;
          bindIPBtn.textContent = this.currentLang === 'en' ? 'IP Bound' : 'IP已绑定';
          bindIPBtn.classList.add('bg-monkey-green', 'hover:bg-monkey-green/90');
          bindIPBtn.classList.remove('bg-monkey-yellow', 'hover:bg-monkey-yellow/90');
          
          // 重置表单
          document.getElementById('activationCode').value = '';
          document.getElementById('activationPassword').value = '';
          document.getElementById('pocketName').value = '';
          document.getElementById('ipAddress').value = '';
          document.getElementById('fullName').value = '';
          document.getElementById('hkid').value = '';
          
          // 启用物品管理功能
          document.getElementById('itemName').disabled = false;
          document.getElementById('itemCategory').disabled = false;
          document.getElementById('itemDescription').disabled = false;
          document.getElementById('addItemBtn').disabled = false;
          
          // 更新UI
          this.updatePocketSelectors();
          this.renderPocketsList();
          this.updateDashboard();
          
          // 添加活动记录
          this.addActivity(this.currentUser.id, 'add_pocket', 
            this.currentLang === 'en' 
              ? `Added new Monkey Pocket: ${pocketName}` 
              : `添加了新百宝袋: ${pocketName}`
          );
          
          // 显示成功消息
          this.showToast(
            this.currentLang === 'en' 
              ? 'Monkey Pocket added successfully!' 
              : '百宝袋添加成功！',
            'success'
          );
        }, 1500);
      },
      
      // 处理添加物品
      handleAddItem() {
        if (!this.currentUser) return;
        
        const itemName = document.getElementById('itemName').value.trim();
        const itemCategory = document.getElementById('itemCategory').value;
        const itemDescription = document.getElementById('itemDescription').value.trim();
        const targetPocketId = document.getElementById('targetPocket').value;
        
        const storageFullError = document.getElementById('storageFullError');
        
        // 验证输入
        if (!itemName || !targetPocketId) {
          this.showToast(
            this.currentLang === 'en' 
              ? 'Please enter item name and select a pocket.' 
              : '请输入物品名称并选择百宝袋。',
            'error'
          );
          return;
        }
        
        const userData = this.getUserData(this.currentUser.id);
        if (!userData) return;
        
        // 查找目标百宝袋
        const pocketIndex = userData.pockets.findIndex(p => p.id === targetPocketId);
        if (pocketIndex === -1) return;
        
        const pocket = userData.pockets[pocketIndex];
        
        // 检查存储空间
        if (pocket.usedSlots >= pocket.storageSlots) {
          storageFullError.classList.remove('hidden');
          return;
        }
        
        storageFullError.classList.add('hidden');
        
        // 创建新物品
        const newItem = {
          id: 'item_' + Date.now(),
          name: itemName,
          category: itemCategory,
          description: itemDescription || (this.currentLang === 'en' ? 'No description' : '无描述'),
          addedAt: new Date().toISOString()
        };
        
        // 添加到百宝袋
        pocket.items.push(newItem);
        pocket.usedSlots++;
        
        // 保存更新后的数据
        userData.pockets[pocketIndex] = pocket;
        this.saveUserData(this.currentUser.id, userData);
        
        // 重置表单
        document.getElementById('itemForm').reset();
        
        // 更新UI
        this.renderItemsList();
        this.updateStorageStatus();
        this.updateDashboard();
        
        // 添加活动记录
        this.addActivity(this.currentUser.id, 'add_item', 
          this.currentLang === 'en' 
            ? `Added new item: ${itemName}` 
            : `添加了新物品: ${itemName}`
        );
        
        // 显示成功消息
        this.showToast(
          this.currentLang === 'en' 
            ? 'Item added successfully!' 
            : '物品添加成功！',
          'success'
        );
      },
      
      // 处理购买按钮点击
      handlePurchaseButtonClick(button) {
        // 检查是否有百宝袋
        if (!this.currentUser) return;
        
        const userData = this.getUserData(this.currentUser.id);
        if (!userData || userData.pockets.length === 0) {
          this.showToast(
            this.currentLang === 'en' 
              ? 'Please add a Monkey Pocket first.' 
              : '请先添加一个百宝袋。',
            'error'
          );
          return;
        }
        
        // 显示购买模态框
        const planSlots = parseInt(button.getAttribute('data-plan'));
        const planPrice = parseInt(button.getAttribute('data-price'));
        
        let planName = '';
        let planDetails = '';
        
        if (planSlots === 5) {
          planName = this.currentLang === 'en' ? 'Basic Plan' : '基础套餐';
          planDetails = this.currentLang === 'en' ? '5 additional storage slots' : '5 个额外存储格';
        } else if (planSlots === 13) {
          planName = this.currentLang === 'en' ? 'Advanced Plan' : '进阶套餐';
          planDetails = this.currentLang === 'en' ? '13 additional storage slots' : '13 个额外存储格';
        } else if (planSlots === 30) {
          planName = this.currentLang === 'en' ? 'Premium Plan' : '高级套餐';
          planDetails = this.currentLang === 'en' ? '30 additional storage slots' : '30 个额外存储格';
        }
        
        // 更新模态框内容
        document.getElementById('purchasePlanName').textContent = planName;
        document.getElementById('purchasePlanDetails').textContent = planDetails;
        document.getElementById('purchasePlanPrice').textContent = `$${planPrice} ${this.currentLang === 'en' ? 'HKD' : 'HKD'}`;
        
        // 设置购买数据
        sessionStorage.setItem('pendingPurchaseSlots', planSlots);
        sessionStorage.setItem('pendingPurchasePrice', planPrice);
        
        // 显示购买模态框
        document.getElementById('purchaseModal').classList.remove('hidden');
        
        // 更新百宝袋选择
        const purchasePocketSelector = document.getElementById('purchasePocketSelector');
        if (purchasePocketSelector && purchasePocketSelector.options.length > 0) {
          // 如果已经有选中的百宝袋，保持选中
          if (this.selectedPocketId) {
            purchasePocketSelector.value = this.selectedPocketId;
          } else {
            // 否则选择第一个百宝袋
            purchasePocketSelector.selectedIndex = 1;
          }
          this.updatePurchasePocketInfo();
        }
        
        // 添加百宝袋选择更改事件
        purchasePocketSelector.addEventListener('change', () => this.updatePurchasePocketInfo());
      },
      
      // 更新购买百宝袋信息
      updatePurchasePocketInfo() {
        const purchasePocketSelector = document.getElementById('purchasePocketSelector');
        const purchasePocketName = document.getElementById('purchasePocketName');
        
        if (purchasePocketSelector && purchasePocketName) {
          const selectedOption = purchasePocketSelector.options[purchasePocketSelector.selectedIndex];
          if (selectedOption.value) {
            purchasePocketName.textContent = selectedOption.text;
          } else {
            purchasePocketName.textContent = this.currentLang === 'en' ? 'Not selected' : '未选择';
          }
        }
      },
      
      // 关闭购买模态框
      closePurchaseModal() {
        document.getElementById('purchaseModal').classList.add('hidden');
        sessionStorage.removeItem('pendingPurchaseSlots');
        sessionStorage.removeItem('pendingPurchasePrice');
        
        // 移除百宝袋选择更改事件
        const purchasePocketSelector = document.getElementById('purchasePocketSelector');
        if (purchasePocketSelector) {
          purchasePocketSelector.removeEventListener('change', () => this.updatePurchasePocketInfo());
        }
      },
      
      // 处理购买
      handlePurchase() {
        const pocketId = document.getElementById('purchasePocketSelector').value;
        const planSlots = parseInt(sessionStorage.getItem('pendingPurchaseSlots'));
        const planPrice = parseInt(sessionStorage.getItem('pendingPurchasePrice'));
        
        if (!pocketId || !planSlots || !planPrice) {
          this.showToast(
            this.currentLang === 'en' 
              ? 'Please select a pocket and plan.' 
              : '请选择百宝袋和套餐。',
            'error'
          );
          return;
        }
        
        if (!this.currentUser) return;
        
        const userData = this.getUserData(this.currentUser.id);
        if (!userData) return;
        
        // 查找目标百宝袋
        const pocketIndex = userData.pockets.findIndex(p => p.id === pocketId);
        if (pocketIndex === -1) return;
        
        const pocket = userData.pockets[pocketIndex];
        
        // 模拟购买过程
        const confirmPurchase = document.getElementById('confirmPurchase');
        confirmPurchase.disabled = true;
        confirmPurchase.innerHTML = '<i class="fa fa-spinner fa-spin mr-2"></i>' + (this.currentLang === 'en' ? 'Processing...' : '处理中...');
        
        setTimeout(() => {
          // 增加存储格
          pocket.storageSlots += planSlots;
          pocket.purchasedSlots += planSlots;
          
          // 添加购买记录
          if (!pocket.purchaseHistory) {
            pocket.purchaseHistory = [];
          }
          
          pocket.purchaseHistory.push({
            slots: planSlots,
            price: planPrice,
            date: new Date().toISOString(),
            planName: planSlots === 5 ? (this.currentLang === 'en' ? 'Basic Plan' : '基础套餐') : 
                     planSlots === 13 ? (this.currentLang === 'en' ? 'Advanced Plan' : '进阶套餐') : 
                     (this.currentLang === 'en' ? 'Premium Plan' : '高级套餐')
          });
          
          // 保存更新后的数据
          userData.pockets[pocketIndex] = pocket;
          this.saveUserData(this.currentUser.id, userData);
          
          // 关闭模态框
          this.closePurchaseModal();
          
          // 重置按钮
          confirmPurchase.disabled = false;
          confirmPurchase.innerHTML = this.currentLang === 'en' ? 'Confirm Purchase' : '确认购买';
          
          // 更新UI
          this.updateStorageStatus();
          this.updateDashboard();
          
          // 添加活动记录
          this.addActivity(this.currentUser.id, 'purchase', 
            this.currentLang === 'en' 
              ? `Purchased ${planSlots} storage slots for ${pocket.name}` 
              : `为 ${pocket.name} 购买了 ${planSlots} 个存储格`
          );
          
          // 显示成功消息
          this.showToast(
            this.currentLang === 'en' 
              ? 'Purchase successful! Storage slots have been added to your pocket.' 
              : '购买成功！存储格已添加到您的百宝袋。',
            'success'
          );
        }, 2000);
      },
      
      // 处理生成激活码
      handleGenerateCodes() {
        const codeCount = parseInt(document.getElementById('codeCount').value);
        const passwordLength = parseInt(document.getElementById('passwordLength').value);
        const complexity = document.querySelector('input[name="complexity"]:checked').value;
        const expiryDate = document.getElementById('expiryDate').value;
        
        if (codeCount < 1 || codeCount > 100) {
          this.showToast('生成数量必须在1到100之间', 'error');
          return;
        }
        
        if (passwordLength < 6 || passwordLength > 20) {
          this.showToast('密码长度必须在6到20之间', 'error');
          return;
        }
        
        // 生成激活码
        const generatedCodes = [];
        
        for (let i = 0; i < codeCount; i++) {
          const code = this.generateActivationCode();
          const password = this.generatePassword(passwordLength, complexity);
          
          // 检查激活码是否已存在
          if (!this.activationCodes[code]) {
            const codeData = {
              password: password,
              used: false,
              userId: null,
              pocketId: null,
              generatedAt: new Date().toISOString(),
              expiresAt: expiryDate || null,
              generatedBy: this.currentAdmin ? this.currentAdmin.username : 'system'
            };
            
            this.activationCodes[code] = codeData;
            generatedCodes.push({ code, password, status: '未使用' });
          } else {
            // 如果激活码已存在，重新生成
            i--;
          }
        }
        
        // 保存激活码到本地存储
        this.saveActivationCodesToStorage();
        
        // 显示生成的激活码
        this.displayGeneratedCodes(generatedCodes);
        
        // 显示成功消息
        this.showToast(`成功生成 ${codeCount} 个激活码`, 'success');
      },
      
      // 显示生成的激活码
      displayGeneratedCodes(codes) {
        const container = document.getElementById('generatedCodesContainer');
        const list = document.getElementById('generatedCodesList');
        
        container.classList.remove('hidden');
        list.innerHTML = '';
        
        codes.forEach((codeData, index) => {
          const row = document.createElement('tr');
          row.className = 'border-b border-monkey-gray/30 last:border-0';
          row.innerHTML = `
            <td class="py-2 px-3">${index + 1}</td>
            <td class="py-2 px-3 font-mono">${codeData.code}</td>
            <td class="py-2 px-3 font-mono">${codeData.password}</td>
            <td class="py-2 px-3">
              <span class="px-2 py-1 rounded-full text-xs bg-green-500/20 text-green-400">${codeData.status}</span>
            </td>
          `;
          list.appendChild(row);
        });
      },
      
      // 复制所有激活码到剪贴板
      copyAllCodesToClipboard() {
        const rows = document.querySelectorAll('#generatedCodesList tr');
        let text = '序号,激活码,密码,状态\n';
        
        rows.forEach((row, index) => {
          const cells = row.querySelectorAll('td');
          const code = cells[1].textContent;
          const password = cells[2].textContent;
          const status = cells[3].textContent;
          text += `${index + 1},${code},${password},${status}\n`;
        });
        
        navigator.clipboard.writeText(text).then(() => {
          this.showToast('激活码已复制到剪贴板', 'success');
        }).catch(err => {
          this.showToast('复制失败: ' + err, 'error');
        });
      },
      
      // 渲染管理员用户列表
      renderAdminUsersList() {
        const usersList = document.getElementById('usersList');
        const noUsersMessage = document.getElementById('noUsersMessage');
        
        if (!usersList) return;
        
        // 清空列表
        usersList.innerHTML = '';
        
        const users = Object.values(this.users);
        
        if (users.length === 0) {
          noUsersMessage.classList.remove('hidden');
          return;
        }
        
        noUsersMessage.classList.add('hidden');
        
        // 渲染用户列表
        users.forEach(user => {
          const userData = this.getUserData(user.id);
          const pocketCount = userData ? userData.pockets.length : 0;
          
          const row = document.createElement('tr');
          row.className = 'border-b border-monkey-gray/30 hover:bg-monkey-gray/30';
          row.innerHTML = `
            <td class="py-3 px-4">${user.username}</td>
            <td class="py-3 px-4">${user.email}</td>
            <td class="py-3 px-4">${new Date(user.createdAt).toLocaleDateString()}</td>
            <td class="py-3 px-4">${user.lastLogin ? new Date(user.lastLogin).toLocaleDateString() : '从未登录'}</td>
            <td class="py-3 px-4">${pocketCount}</td>
            <td class="py-3 px-4">
              <button class="text-monkey-blue hover:text-monkey-blue/80 text-sm view-user-pockets" data-userid="${user.id}">
                <i class="fa fa-eye mr-1"></i> 查看百宝袋
              </button>
            </td>
          `;
          usersList.appendChild(row);
        });
        
        // 添加查看百宝袋按钮事件监听
        document.querySelectorAll('.view-user-pockets').forEach(btn => {
          btn.addEventListener('click', (e) => {
            const userId = btn.getAttribute('data-userid');
            this.viewUserPockets(userId);
          });
        });
      },
      
      // 查看用户百宝袋
      viewUserPockets(userId) {
        const user = Object.values(this.users).find(u => u.id === userId);
        if (!user) return;
        
        const userData = this.getUserData(userId);
        if (!userData) return;
        
        // 创建模态框显示用户百宝袋
        const modal = document.createElement('div');
        modal.className = 'fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4';
        modal.innerHTML = `
          <div class="bg-monkey-darker rounded-xl max-w-4xl w-full max-h-[90vh] overflow-hidden border border-monkey-gray/50">
            <div class="flex justify-between items-center p-6 border-b border-monkey-gray/50">
              <h3 class="text-xl font-semibold">${user.username} 的百宝袋</h3>
              <button class="text-gray-400 hover:text-white close-user-pockets-modal">
                <i class="fa fa-times"></i>
              </button>
            </div>
            <div class="p-6 overflow-y-auto max-h-[70vh]">
              ${userData.pockets.length === 0 ? 
                '<p class="text-center text-gray-500 py-8">该用户尚未添加任何百宝袋</p>' : 
                this.renderUserPocketsTable(userData.pockets)}
            </div>
          </div>
        `;
        
        document.body.appendChild(modal);
        
        // 添加关闭事件
        modal.querySelector('.close-user-pockets-modal').addEventListener('click', () => {
          document.body.removeChild(modal);
        });
      },
      
      // 渲染用户百宝袋表格
      renderUserPocketsTable(pockets) {
        let html = '<table class="w-full">';
        html += `
          <thead>
            <tr class="border-b border-monkey-gray">
              <th class="text-left py-3 px-4">激活码</th>
              <th class="text-left py-3 px-4">名称</th>
              <th class="text-left py-3 px-4">IP地址</th>
              <th class="text-left py-3 px-4">存储格</th>
              <th class="text-left py-3 px-4">物品数量</th>
              <th class="text-left py-3 px-4">激活日期</th>
            </tr>
          </thead>
          <tbody>
        `;
        
        pockets.forEach(pocket => {
          html += `
            <tr class="border-b border-monkey-gray/30 hover:bg-monkey-gray/30">
              <td class="py-3 px-4">${pocket.activationCode}</td>
              <td class="py-3 px-4">${pocket.name}</td>
              <td class="py-3 px-4">${pocket.ipAddress || '未绑定'}</td>
              <td class="py-3 px-4">${pocket.usedSlots}/${pocket.storageSlots}</td>
              <td class="py-3 px-4">${pocket.items.length}</td>
              <td class="py-3 px-4">${new Date(pocket.createdAt).toLocaleDateString()}</td>
            </tr>
          `;
        });
        
        html += '</tbody></table>';
        return html;
      },
      
      // 渲染管理员百宝袋列表
      renderAdminPocketsList() {
        const pocketsList = document.getElementById('pocketsListAdmin');
        const noPocketsAdminMessage = document.getElementById('noPocketsAdminMessage');
        
        if (!pocketsList) return;
        
        // 清空列表
        pocketsList.innerHTML = '';
        
        // 收集所有百宝袋
        let allPockets = [];
        
        Object.values(this.users).forEach(user => {
          const userData = this.getUserData(user.id);
          if (userData && userData.pockets.length > 0) {
            userData.pockets.forEach(pocket => {
              allPockets.push({
                ...pocket,
                username: user.username,
                userEmail: user.email
              });
            });
          }
        });
        
        if (allPockets.length === 0) {
          noPocketsAdminMessage.classList.remove('hidden');
          return;
        }
        
        noPocketsAdminMessage.classList.add('hidden');
        
        // 渲染百宝袋列表
        allPockets.forEach(pocket => {
          const row = document.createElement('tr');
          row.className = 'border-b border-monkey-gray/30 hover:bg-monkey-gray/30';
          row.innerHTML = `
            <td class="py-3 px-4">${pocket.activationCode}</td>
            <td class="py-3 px-4">${pocket.name}</td>
            <td class="py-3 px-4">${pocket.username} (${pocket.userEmail})</td>
            <td class="py-3 px-4">${pocket.ipAddress || '未绑定'}</td>
            <td class="py-3 px-4">${pocket.usedSlots}/${pocket.storageSlots}</td>
            <td class="py-3 px-4">${pocket.items.length}</td>
            <td class="py-3 px-4">${new Date(pocket.createdAt).toLocaleDateString()}</td>
            <td class="py-3 px-4">
              <button class="text-monkey-blue hover:text-monkey-blue/80 text-sm view-pocket-items" data-pocketid="${pocket.id}" data-userid="${pocket.userId}">
                <i class="fa fa-box mr-1"></i> 查看物品
              </button>
            </td>
          `;
          pocketsList.appendChild(row);
        });
        
        // 添加查看物品按钮事件监听
        document.querySelectorAll('.view-pocket-items').forEach(btn => {
          btn.addEventListener('click', (e) => {
            const pocketId = btn.getAttribute('data-pocketid');
            const userId = btn.getAttribute('data-userid');
            this.viewPocketItems(pocketId, userId);
          });
        });
      },
      
      // 查看百宝袋物品
      viewPocketItems(pocketId, userId) {
        const userData = this.getUserData(userId);
        if (!userData) return;
        
        const pocket = userData.pockets.find(p => p.id === pocketId);
        if (!pocket) return;
        
        // 创建模态框显示百宝袋物品
        const modal = document.createElement('div');
        modal.className = 'fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4';
        modal.innerHTML = `
          <div class="bg-monkey-darker rounded-xl max-w-4xl w-full max-h-[90vh] overflow-hidden border border-monkey-gray/50">
            <div class="flex justify-between items-center p-6 border-b border-monkey-gray/50">
              <h3 class="text-xl font-semibold">${pocket.name} 的物品 (${pocket.activationCode})</h3>
              <button class="text-gray-400 hover:text-white close-pocket-items-modal">
                <i class="fa fa-times"></i>
              </button>
            </div>
            <div class="p-6 overflow-y-auto max-h-[70vh]">
              ${pocket.items.length === 0 ? 
                '<p class="text-center text-gray-500 py-8">该百宝袋中暂无物品</p>' : 
                this.renderPocketItemsTable(pocket.items)}
            </div>
          </div>
        `;
        
        document.body.appendChild(modal);
        
        // 添加关闭事件
        modal.querySelector('.close-pocket-items-modal').addEventListener('click', () => {
          document.body.removeChild(modal);
        });
      },
      
      // 渲染百宝袋物品表格
      renderPocketItemsTable(items) {
        const categoryLabels = {
          'electronics': '电子产品',
          'clothing': '衣物',
          'accessories': '配件',
          'documents': '文件',
          'personal': '个人物品',
          'other': '其他'
        };
        
        let html = '<table class="w-full">';
        html += `
          <thead>
            <tr class="border-b border-monkey-gray">
              <th class="text-left py-3 px-4">物品名称</th>
              <th class="text-left py-3 px-4">类别</th>
              <th class="text-left py-3 px-4">描述</th>
              <th class="text-left py-3 px-4">添加时间</th>
            </tr>
          </thead>
          <tbody>
        `;
        
        items.forEach(item => {
          html += `
            <tr class="border-b border-monkey-gray/30 hover:bg-monkey-gray/30">
              <td class="py-3 px-4">${item.name}</td>
              <td class="py-3 px-4">${categoryLabels[item.category] || item.category}</td>
              <td class="py-3 px-4">${item.description || '无描述'}</td>
              <td class="py-3 px-4">${item.addedAt ? new Date(item.addedAt).toLocaleDateString() : '未知'}</td>
            </tr>
          `;
        });
        
        html += '</tbody></table>';
        return html;
      },
      
      // 渲染管理员激活码列表
      renderAdminCodesList() {
        const codesList = document.getElementById('codesList');
        const noCodesMessage = document.getElementById('noCodesMessage');
        
        if (!codesList) return;
        
        // 清空列表
        codesList.innerHTML = '';
        
        const codes = Object.entries(this.activationCodes);
        
        if (codes.length === 0) {
          noCodesMessage.classList.remove('hidden');
          return;
        }
        
        noCodesMessage.classList.add('hidden');
        
        // 渲染激活码列表
        codes.forEach(([code, data]) => {
          // 获取使用者信息
          let userName = '未使用';
          if (data.userId) {
            const user = Object.values(this.users).find(u => u.id === data.userId);
            if (user) {
              userName = user.username;
            }
          }
          
          // 确定状态
          let status = '未使用';
          let statusColor = 'bg-green-500/20 text-green-400';
          
          if (data.used) {
            status = '已使用';
            statusColor = 'bg-blue-500/20 text-blue-400';
          }
          
          if (data.expiresAt && new Date(data.expiresAt) < new Date()) {
            status = '已过期';
            statusColor = 'bg-red-500/20 text-red-400';
          }
          
          const row = document.createElement('tr');
          row.className = 'border-b border-monkey-gray/30 hover:bg-monkey-gray/30';
          row.innerHTML = `
            <td class="py-3 px-4 font-mono">${code}</td>
            <td class="py-3 px-4 font-mono">${data.password}</td>
            <td class="py-3 px-4">
              <span class="px-2 py-1 rounded-full text-xs ${statusColor}">${status}</span>
            </td>
            <td class="py-3 px-4">${userName}</td>
            <td class="py-3 px-4">${new Date(data.generatedAt).toLocaleDateString()}</td>
            <td class="py-3 px-4">${data.expiresAt ? new Date(data.expiresAt).toLocaleDateString() : '永久有效'}</td>
            <td class="py-3 px-4">
              <button class="text-monkey-red hover:text-monkey-red/80 text-sm delete-code" data-code="${code}">
                <i class="fa fa-trash mr-1"></i> 删除
              </button>
            </td>
          `;
          codesList.appendChild(row);
        });
        
        // 添加删除激活码按钮事件监听
        document.querySelectorAll('.delete-code').forEach(btn => {
          btn.addEventListener('click', (e) => {
            const code = btn.getAttribute('data-code');
            this.deleteActivationCode(code);
          });
        });
      },
      
      // 删除激活码
      deleteActivationCode(code) {
        if (!confirm(`确定要删除激活码 ${code} 吗？`)) return;
        
        if (this.activationCodes[code]) {
          delete this.activationCodes[code];
          this.saveActivationCodesToStorage();
          this.renderAdminCodesList();
          this.updateAdminDashboard();
          this.showToast('激活码删除成功', 'success');
        }
      },
      
      // 搜索用户
      searchUsers(query) {
        const rows = document.querySelectorAll('#usersList tr');
        const noUsersMessage = document.getElementById('noUsersMessage');
        
        let hasResults = false;
        
        rows.forEach(row => {
          const text = row.textContent.toLowerCase();
          if (text.includes(query.toLowerCase())) {
            row.style.display = '';
            hasResults = true;
          } else {
            row.style.display = 'none';
          }
        });
        
        if (hasResults) {
          noUsersMessage.classList.add('hidden');
        } else {
          noUsersMessage.classList.remove('hidden');
        }
      },
      
      // 搜索百宝袋
      searchPockets(query) {
        const rows = document.querySelectorAll('#pocketsListAdmin tr');
        const noPocketsAdminMessage = document.getElementById('noPocketsAdminMessage');
        
        let hasResults = false;
        
        rows.forEach(row => {
          const text = row.textContent.toLowerCase();
          if (text.includes(query.toLowerCase())) {
            row.style.display = '';
            hasResults = true;
          } else {
            row.style.display = 'none';
          }
        });
        
        if (hasResults) {
          noPocketsAdminMessage.classList.add('hidden');
        } else {
          noPocketsAdminMessage.classList.remove('hidden');
        }
      },
      
      // 搜索激活码
      searchCodes(query) {
        const rows = document.querySelectorAll('#codesList tr');
        const noCodesMessage = document.getElementById('noCodesMessage');
        
        let hasResults = false;
        
        rows.forEach(row => {
          const text = row.textContent.toLowerCase();
          if (text.includes(query.toLowerCase())) {
            row.style.display = '';
            hasResults = true;
          } else {
            row.style.display = 'none';
          }
        });
        
        if (hasResults) {
          noCodesMessage.classList.add('hidden');
        } else {
          noCodesMessage.classList.remove('hidden');
        }
      },
      
      // 按状态筛选激活码
      filterCodesByStatus(status) {
        const rows = document.querySelectorAll('#codesList tr');
        const noCodesMessage = document.getElementById('noCodesMessage');
        
        let hasResults = false;
        
        rows.forEach(row => {
          const statusCell = row.querySelector('td:nth-child(3)');
          if (statusCell) {
            const codeStatus = statusCell.textContent.trim();
            
            if (status === 'all' || 
                (status === 'unused' && codeStatus === '未使用') ||
                (status === 'used' && codeStatus === '已使用') ||
                (status === 'expired' && codeStatus === '已过期')) {
              row.style.display = '';
              hasResults = true;
            } else {
              row.style.display = 'none';
            }
          }
        });
        
        if (hasResults) {
          noCodesMessage.classList.add('hidden');
        } else {
          noCodesMessage.classList.remove('hidden');
        }
      }
    };
    
    // 初始化应用程序
    document.addEventListener('DOMContentLoaded', () => {
      AppState.init();
    });
  </script>
</body>
</html>
